!function(e){function t(t){for(var o,n,a=t[0],c=t[1],l=t[2],m=0,u=[];m<a.length;m++)n=a[m],r[n]&&u.push(r[n][0]),r[n]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(d&&d(t);u.length;)u.shift()();return s.push.apply(s,l||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],o=!0,a=1;a<i.length;a++){var c=i[a];0!==r[c]&&(o=!1)}o&&(s.splice(t--,1),e=n(n.s=i[0]))}return e}var o={},r={"web/emoji":0},s=[];function n(t){if(o[t])return o[t].exports;var i=o[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=o,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/js/cmodules/";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var d=c;s.push([129,"bundles/common"]),i()}({129:function(e,t,i){e.exports=i("5Y++")},"5Y++":function(e,t,i){"use strict";i.r(t);var o=i("lBJi");window.Emoji||(window.Emoji=o.Emoji);try{window.stManager.done(window.jsc("web/emoji.js"))}catch(e){}},lBJi:function(e,t,i){"use strict";i.r(t);i("a1Th"),i("rE2o"),i("ioFf"),i("Vd3H"),i("91GP"),i("KKXr"),i("rGqo"),i("Btvt"),i("HEwt"),i("Oyvg"),i("SRfc"),i("pIFo");var o=i("S6+Z"),r=i("TxR4"),s=i("yqpO"),n={1:["😀","😃","😄","😁","😅","😆","😂","🤣","😉","😊","☺","🙂","🙃","😇","😗","😙","😚","😘","😍","🥰","🤩","🤗","😋","😜","🤪","😛","😝","🤑","🤭","🤐","🤫","😶","🤔","🤨","🧐","😐","😑","🙄","😬","🤥","😏","😌","🤤","😴","🤓","😎","🥳","🤠","😒","😔","😪","😕","😟","🙁","☹","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","😷","🤒","🤕","🤢","🤮","🤧","🥶","🥵","🥴","😵","🤯","😤","😠","😡","🤬","😈","👿","💀","☠","💩","🤡","👹","👺","👻","👽","👾","🤖","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🙈","🙉","🙊","🦠"],2:["🐵","🐒","🦍","🐶","🐕","🐩","🐺","🦊","🦝","🐱","🐈","🦁","🐯","🐅","🐆","🐴","🐎","🦄","🦓","🦌","🐮","🐂","🐃","🐄","🐷","🐽","🐖","🐗","🐏","🐑","🐐","🐪","🐫","🦙","🦒","🐘","🦏","🦛","🐭","🐁","🐀","🐹","🐰","🐇","🐿","🦔","🦇","🐻","🐨","🐼","🦘","🦡","🐾","🦃","🐔","🐓","🐣","🐤","🐥","🐦","🐧","🕊","🦅","🦆","🦢","🦉","🦚","🦜","🐸","🐊","🐢","🦎","🐍","🐲","🐉","🦕","🦖","🐳","🐋","🐬","🐟","🐠","🐡","🦈","🐙","🦀","🦞","🦐","🦑","🐚","🐌","🦋","🐛","🐜","🐝","🐞","🦗","🕷","🕸","🦂","🦟","💐","🌸","💮","🏵","🌹","🥀","🌺","🌻","🌼","🌷","🌳","🌲","🎄","🌴","🌵","🌾","🌱","🌿","☘","🍀","🍁","🍂","🍃","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌛","🌜","🌡","☀","🌝","🌞","⭐","🌟","🌠","☁","⛅","⛈","🌤","🌥","🌦","🌧","🌨","🌩","🌪","🌫","🌬","💨","🌀","🌈","🌂","☂","☔","⛱","⚡","❄","☃","⛄","☄","🔥","💦","💧","🌊"],3:["👍🏻","👎🏻","👌🏻","✌🏻","🤞🏻","🤟🏻","🤘🏻","🤙🏻","🖕🏻","✊🏻","👊🏻","🤛🏻","🤜🏻","👈🏻","👉🏻","👆🏻","👇🏻","☝🏻","👋🏻","🤚🏻","🖐🏻","✋🏻","🖖🏻","👏🏻","🙌🏻","👐🏻","🤲🏻","🤝🏻","🙏🏻","💪🏻","🦵🏻","🦶🏻","👂🏻","👃🏻","🧠","🦷","🦴","👀","👁","👅","👄","✍🏻","💅🏻","🤳","👫","👭","👬","👩‍❤️‍💋‍👨","👨‍❤️‍💋‍👨","👩‍❤️‍💋‍👩","👩‍❤️‍👨","👨‍❤️‍👨","👩‍❤️‍👩","👪","👶","🧒","👦","👧","🧑","👱","👨","🧔","👱‍♂️","👨‍🦰","👨‍🦱","👨‍🦳","👨‍🦲","👩","👱‍♀️","👩‍🦰","👩‍🦱","👩‍🦳","👩‍🦲","🧓️","👴️","👵️","🙍‍♂️️","🙍‍♀️️","🙎‍♂️","🙎‍♀️️","🙅‍♂️","🙅‍♀️","🙆‍♂️","🙆‍♀️","💁‍♂️","💁‍♀️️","🙋‍♂️","🙋‍♀️️","🙇‍♂️","🙇‍♀️️","🤦‍♂️","🤦‍♀️","🤷‍♂️","🤷‍♀️","💆‍♂️️","💆‍♀️","💇‍♂️️","💇‍♀️","🚶‍♂️️","🚶‍♀️️","🏃‍♂️️","🏃‍♀️","💃","🕺","🕴️","👯‍♂️️","👯‍♀️","🧖‍♂️","🧖‍♀️️","👼","🎅","🤶","🦸‍♂️","🦸‍♀️","🦹‍♂️","🦹‍♀️","🧙‍♂️","🧙‍♀️","🧚‍♂️","🧚‍♀️","🧛‍♂️","🧛‍♀️","🧜‍♂️","🧜‍♀️","🧝‍♂️","🧝‍♀️","🧞‍♂️","🧞‍♀️","🧟‍♂️","🧟‍♀️","👨‍⚕️","👩‍⚕️","👨‍🎓","👩‍🎓","👨‍🏫","👩‍🏫","👨‍⚖️","👩‍⚖️","👨‍🌾","👩‍🌾","👨‍🍳","👩‍🍳","👨‍🔧","👩‍🔧","👨‍🏭","👩‍🏭","👨‍💼","👩‍💼","👨‍🔬","👩‍🔬","👨‍💻","👩‍💻","👨‍🎤","👩‍🎤","👨‍🎨","👩‍🎨","👨‍✈️","👩‍✈️","👨‍🚀","👩‍🚀","👨‍🚒","👩‍🚒","👮‍♂️","👮‍♀️","🕵️‍♂️","🕵️‍♀️","💂‍♂️","💂‍♀️","👷‍♂️","👷‍♀️","🤴","👸","👳‍♂️","👳‍♀️","👲","🧕","🤵","👰","🤰","🤱","🛀","🛌"],4:["🍏","🍎","🍐","🍅","🥝","🍑","🍒","🍓","🍇","🍈","🍉","🍊","🍋","🍌","🍍","🥭","🥥","🥑","🍆","🥔","🥕","🌽","🌶","🥒","🥬","🥦","🍄","🥜","🌰","🍞","🥐","🥖","🥨","🥯","🥞","🧀","🍖","🍗","🥩","🥓","🍔","🍟","🍕","🌭","🥪","🌮","🌯","🥙","🥚","🍳","🥘","🍲","🥣","🥗","🍿","🧂","🥫","🍱","🍘","🍙","🍚","🍛","🍜","🍝","🍠","🍢","🍣","🍤","🍥","🥮","🍡","🥟","🥠","🥡","🍦","🍧","🍨","🍩","🍪","🎂","🍰","🧁","🥧","🍫","🍬","🍭","🍮","🍯","🍼","🥛","☕","🍵","🍶","🍾","🍷","🍸","🍹","🍺","🍻","🥂","🥃","🥤","🥢","🍽","🍴","🥄"],5:["⚽","⚾","🥎","🏀","🏐","🏈","🏉","🎾","🥏","🎳","🏏","🏑","🏒","🥍","🏓","🏸","🥊","🥋","🥅","⛳","⛸","🎣","🎽","🛹","🎿","🛷","🥌","🎯","🎱","🎮","🕹","🎰","🎲","🧩","♟","🧗‍♂️️","🧗‍♀️","🤺","🏇","⛷","🏂","🏌️‍♂️","🏌️‍♀️","🏄‍♂️","🏄‍♀️","🚣‍♂️","🚣‍♀️","🏊‍♂️","🏊‍♀️","⛹️‍♂️","⛹️‍♀️","🏋️‍♂️","🏋️‍♀️","🚴‍♂️","🚴‍♀️","🚵‍♂️","🚵‍♀️","🤸","🤼‍♂️","🤼‍♀️","🤽‍♂️","🤽‍♀️","🤾‍♂️","🤾‍♀️","🤹‍♂️","🤹‍♀️","🧘‍♂️","🧘‍♀️","🎖","🏆","🏅","🥇","🥈","🥉"],6:["🚂","🚃","🚄","🚅","🚆","🚇","🚈","🚉","🚊","🚝","🚞","🚋","🚌","🚍","🚎","🚐","🚑","🚒","🚓","🚔","🚕","🚖","🚗","🚘","🚙","🚚","🚛","🚜","🏎","🏍","🛵","🚲","🛴","🚏","🛣","🛤","🛢","⛽","🚨","🚥","🚦","🛑","🚧","⚓","⛵","🛶","🚤","🛳","⛴","🛥","🚢","✈","🛩","🛫","🛬","💺","🚁","🚟","🚠","🚡","🛰","🚀","🛸","🌍","🌎","🌏","🌐","🗺","🗾","🧭","🏔","⛰","🌋","🗻","🏕","🏖","🏜","🏝","🏞","🏟","🏛","🏗","🧱","🏘","🏚","🏠","🏡","🏢","🏣","🏤","🏥","🏦","🏨","🏩","🏪","🏫","🏬","🏭","🏯","🏰","💒","🗼","🗽","⛪","🕌","🕍","⛩","🕋","⛲","⛺","🌁","🌃","🏙","🌄","🌅","🌆","🌇","🌉","♨","🌌","🎠","🎡","🎢","💈","🎪"],7:["🎙","🎚","🎛","🎤","🎧","📻","🎷","🎸","🎹","🎺","🎻","🥁","📯","🎭","🖼","🎨","🧵","🧶","🔮","🧿","🧸","🃏","🀄","🎴","🎃","🎆","🎇","🧨","✨","🎈","🎉","🎊","🎋","🎍","🎎","🎏","🎐","🎑","🧧","🎀","🎁","🎗","🎟","🎫","🛎","🧳","⌛","⏳","⌚","⏰","⏱","⏲","🕰","👓","🕶","🥽","🥼","👔","👕","👖","🧣","🧤","🧥","🧦","👗","👘","👙","👚","👛","👜","👝","🛍","🎒","👞","👟","🥾","🥿","👠","👡","👢","👑","👒","🎩","🎓","🧢","⛑","📿","💄","💍","💎","📱","📲","☎","📞","📟","📠","🔋","🔌","💻","🖥","🖨","⌨","🖱","🖲","💽","💾","💿","📀","🧮","🎥","🎞","📽","🎬","📺","📷","📸","📹","📼","🔍","🔎","🕯","💡","🔦","🏮","📔","📕","📖","📗","📘","📙","📚","📓","📒","📃","📜","📄","📰","🗞","📑","🔖","🏷","💰","💴","💵","💶","💷","💸","💳","🧾","💹","💱","💲","✉","💌","📧","📨","📩","📤","📥","📦","📫","📪","📬","📭","📮","🗳","✏","✒","🖋","🖊","🖌","🖍","📝","💼","📁","📂","🗂","📅","📆","🗒","🗓","📇","📈","📉","📊","📋","📌","📍","📎","🖇","📏","📐","✂","🗃","🗄","🗑","🔒","🔓","🔏","🔐","🔑","🗝","🔨","⛏","⚒","🛠","🗡","⚔","🔪","🔫","🏹","🛡","🔧","🔩","⚙","🗜","⚖","🔗","⛓","🧰","🧲","⚗","🧪","🧫","🧬","🔬","🔭","📡","💉","💊","🚪","🛏","🛋","🚽","🚿","🛁","🧴","🧷","🧹","🧺","🧻","🧼","🧽","🧯","🛒","🚬","⚰","⚱","🏺","🗿"],8:["💋","❤","💔","❣","💘","💝","💖","💗","💓","💞","💕","💟","💜","🧡","💛","💚","💙","🖤","💯","💢","💥","💫","🕳","💣","💬","👁️‍🗨️","🗨","🗯","💭","💤","🗣","👤","👥","👣","🔇","🔊","📢","📣","🔔","🔕","🎼","🎵","🎶","⚠","🚸","☢","☣","🆚","🆓","🆕","🚮","🚾","🚭","✅","♻","⚕","🔱","‼","⁉","❓","❗","🆘","⛔","🚫","🚳","🚯","🚱","🚷","📵","🔞"],9:["🇷🇺","🇰🇿","🇧🇾","🇺🇦","🇲🇳","🇬🇪","🇦🇿","🇹🇯","🇧🇷","🇱🇹","🇱🇻","🇪🇪","🇦🇲","🏁","🚩","🎌","🏴","🏳","🏳️‍🌈","🏴‍☠️","🇦🇨","🇦🇩","🇦🇪","🇦🇫","🇦🇬","🇦🇮","🇦🇱","🇦🇴","🇦🇶","🇦🇷","🇦🇸","🇦🇹","🇦🇺","🇦🇼","🇦🇽","🇧🇦","🇧🇧","🇧🇩","🇧🇪","🇧🇫","🇧🇬","🇧🇭","🇧🇮","🇧🇯","🇧🇱","🇧🇲","🇧🇳","🇧🇴","🇧🇶","🇧🇸","🇧🇹","🇧🇻","🇧🇼","🇧🇿","🇨🇦","🇨🇨","🇨🇩","🇨🇫","🇨🇬","🇨🇭","🇨🇮","🇨🇰","🇨🇱","🇨🇲","🇨🇳","🇨🇴","🇨🇵","🇨🇷","🇨🇺","🇨🇻","🇨🇼","🇨🇽","🇨🇾","🇨🇿","🇩🇪","🇩🇬","🇩🇯","🇩🇰","🇩🇲","🇩🇴","🇩🇿","🇪🇨","🇪🇬","🇪🇭","🇪🇷","🇪🇸","🇪🇹","🇪🇺","🇫🇮","🇫🇯","🇫🇰","🇫🇲","🇫🇴","🇫🇷","🇬🇦","🇬🇧","🇬🇩","🇬🇫","🇬🇬","🇬🇭","🇬🇮","🇬🇱","🇬🇲","🇬🇳","🇬🇵","🇬🇶","🇬🇷","🇬🇸","🇬🇹","🇬🇺","🇬🇼","🇬🇾","🇭🇰","🇭🇲","🇭🇳","🇭🇷","🇭🇹","🇭🇺","🇮🇨","🇮🇩","🇮🇪","🇮🇱","🇮🇲","🇮🇳","🇮🇴","🇮🇶","🇮🇷","🇮🇸","🇮🇹","🇯🇪","🇯🇲","🇯🇴","🇯🇵","🇰🇪","🇰🇬","🇰🇭","🇰🇮","🇰🇲","🇰🇳","🇰🇵","🇰🇷","🇰🇼","🇰🇾","🇱🇦","🇱🇧","🇱🇨","🇱🇮","🇱🇰","🇱🇷","🇱🇸","🇱🇺","🇱🇾","🇲🇦","🇲🇨","🇲🇩","🇲🇪","🇲🇫","🇲🇬","🇲🇭","🇲🇰","🇲🇱","🇲🇲","🇲🇴","🇲🇵","🇲🇶","🇲🇷","🇲🇸","🇲🇹","🇲🇺","🇲🇻","🇲🇼","🇲🇽","🇲🇾","🇲🇿","🇳🇦","🇳🇨","🇳🇪","🇳🇫","🇳🇬","🇳🇮","🇳🇱","🇳🇴","🇳🇵","🇳🇷","🇳🇺","🇳🇿","🇴🇲","🇵🇦","🇵🇪","🇵🇫","🇵🇬","🇵🇭","🇵🇰","🇵🇱","🇵🇲","🇵🇳","🇵🇷","🇵🇸","🇵🇹","🇵🇼","🇵🇾","🇶🇦","🇷🇪","🇷🇴","🇷🇸","🇷🇼","🇸🇦","🇸🇧","🇸🇨","🇸🇩","🇸🇪","🇸🇬","🇸🇭","🇸🇮","🇸🇯","🇸🇰","🇸🇱","🇸🇲","🇸🇳","🇸🇴","🇸🇷","🇸🇸","🇸🇹","🇸🇻","🇸🇽","🇸🇾","🇸🇿","🇹🇦","🇹🇨","🇹🇩","🇹🇫","🇹🇬","🇹🇭","🇹🇰","🇹🇱","🇹🇲","🇹🇳","🇹🇴","🇹🇷","🇹🇹","🇹🇻","🇹🇼","🇹🇿","🇺🇬","🇺🇲","🇺🇳","🇺🇸","🇺🇾","🇺🇿","🇻🇦","🇻🇨","🇻🇪","🇻🇬","🇻🇮","🇻🇳","🇻🇺","🇼🇫","🇼🇸","🇽🇰","🇾🇪","🇾🇹","🇿🇦","🇿🇲","🇿🇼"]},a=Object.keys(n).reduce((e,t)=>(e[t]=n[t].map(e=>Object(r.emojiSymbolToByteHex)(e)),e),{});i("hhXQ");function c(e,t){var i=e;return e>68&&(i=68),t>68&&(i=68*e/t),[i,i*(t/e)]}var l=i("W9Tc"),d=i("t7n3"),m=i("zxIV");i("/8Fb");function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw s}}return i}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var _=["мне","тебе","ему","ей","маме","папе","сестре","брату","родителям"],v=["ден(?:ьги|ежки|ьгу|ежку|ег|ежек|як)","дол(?:г|жок)","(?:(?:в|на)\\s)подар(?:ок|ки)"],p=["переводом","(?:(?:по|на)\\s)(?:номеру?\\s)?(?:карт(?:у|очку|ы|очки)|тел(?:ефона)?)","(?:по\\s)?безнал(?:у|ичке|ом|ичкой)","на\\sсбер(?:банк)?"],h=["сот(?:оч)ку","\\d+(?:\\s*р(?:[.,\\s]|уб(?:лей)?|$))?"],k=new RegExp(`(${h.join(")|(")})`);function g(e,t){return"amount"===e?function(e){var t=e.match(k);if(t){if(t[1])return 100;if(t[2])return parseInt(t[2])}return 0}(t):t}var S=new RegExp(`^(?:(${["(?:за|с|пере)?кин(?:ь(?:ся)?|ьте(?:сь)?|ешь(?:ся)?|ете(?:сь)?)","переве(?:ди|дите|дешь|дете)","отправ(?:ь|ьте|ишь|ите)","соб(?:ери|ерите|ерешь|ерете)","(?:от)?да(?:й|йте|шь|дите)","верн(?:и|ите|ешь|ете)","возвра(?:ти|тите|тишь|щай|щайте)","займ(?:и|ите|ешь)"].join("|")})|(${["перевод","(?:за|с|пере)?кин(?:уть(?:ся)?|у(?:сь)?|ем(?:ся)?)","переве(?:сти|вожу|дим|ду|ем)","отправ(?:ить|ляю|ляем|лю|им)","(?:со)?б(?:рать|ираю|ираем|еру|ерем)","(?:от)?да(?:ть|ю|ем|м|дим)","верн(?:уть|у|ем)","возвра(?:тить|щу|тим|щаю|щаем)"].join("|")}))((?:\\s+(?:${[..._,...v,...p,...h].join("|")}))+)\\s*$`),j=new RegExp(`(${_.join("|")})|(${v.join("|")})|(${p.join("|")})|(${h.join("|")})`,"gi"),w={DEFAULT_QUERY:"деньги",introViewed:!1,match:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=e.toLowerCase().replace(/ё/g,"е").match(S);if(t){for(var i={input:e,request:t[1],send:t[2],context:t[3]};t=j.exec(i.context),t;)for(var o={receiver:t[1],subject:t[2],method:t[3],amount:t[4]},r=0,s=Object.entries(o);r<s.length;r++){var n=f(s[r],2),a=n[0],c=n[1];c&&(i[a]=g(a,c))}if(i.subject||i.method||i.amount)return i}return null},setIntroViewed:function(e){this.introViewed=e},onClick:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(this.introViewed){var s=[e,t,i,o].join("_");showBox("al_payments.php",{act:"money_transfer_box",tab:i,amount:o,owner_id:e,to_id:t,from:"sticker_link"},{cache:this.lastBoxId===s,onDone:()=>{cur.paymentsOptions&&(cur.paymentsOptions.onSendStart=r.onSendStart)}}),this.lastBoxId=s}else showWiki(u({w:"moneysend_promo",fromId:e,toId:t,action:i},o?{amount:o}:{})),this.introViewed=!0}},T=i("jE6c");function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw s}}return i}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var b=Object.entries(o.EMOJI_HINTS).map(e=>{var t=E(e,2),i=t[0],o=E(t[1],2),r=(o[0],o[1]);return[new RegExp(`(\\s|^)(${Object(T.escapeRE)(r)}${r.endsWith(")")||r.endsWith("(")?"+":""})([\\s\\.,]|$)`,"gi"),i]}),C={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};browser.mac?C["\\"]="ё":C["`"]="ё";var y=new RegExp(`[${Object(T.escapeRE)(Object.keys(C).join(""))}]`,"gi"),R=e=>e.replace(y,e=>C[e]),I=Object.entries(C).reduce((e,t)=>{var i=E(t,2),o=i[0];return e[i[1]]=o,e}),O=new RegExp(`[${Object(T.escapeRE)(Object.keys(I).join(""))}]`,"gi"),H=e=>e.replace(O,e=>I[e]),B=-184940019;var L=class{constructor(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}setConfig(e){Object.assign(this.config,e)}getQueries(e){if(!e||e.length>this.config.maxInputLength)return[""];var t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){var i=t();i&&(e=e.replace(i,""))}e=e.toLowerCase(),e=(e=b.reduce((e,t)=>{var i=E(t,2),o=i[0],s=i[1];return e.replace(o,(e,t,i,o)=>(t||"")+Object(r.emojiByteHexToSymbol)(s)+(o||""))},e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");for(var o=[e=Object(r.emojiRemoveSkinToneModifiers)(e)],s=0,n=[...o];s<n.length;s++){var a=n[s];o.push(R(a)),o.push(H(a))}for(var c=0,l=[...o];c<l.length;c++){var d=l[c];o.push(d.replace(/ё/g,"е")),o.push(d.replace(/е/g,"ё"))}for(var m=0,u=[...o];m<u.length;m++){var f=u[m];o.push(f.replace(/[.!?]+$/,""))}return Object.keys(o.reduce((e,t)=>(e[t]=1,e),{}))}isBotLinkEnabled(){return Object(l.partConfigEnabled)("stickers_bot_link")&&this.config.peerId!==B}getBotLinkUrl(){return this.config.mvk?`/mail?act=show&peer=${B}`:`/im?sel=${B}`}getBotLinkImageUrl(e){return`/images/stickers_suggestions_bot_light_${e}.png`}getBotLinkClickStatName(){return"stickers_suggestions_bot_link"}getBotLinkClickStatKeys(){return[]}isMoneyTransferEnabled(){return Object(l.partConfigEnabled)("stickers_money_transfer_suggestions")&&(this.isMoneySendEnabled()||this.isMoneyRequestEnabled())}isMoneySendEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)}isMoneyRequestEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)}},x=i("QGEU"),A=i("v+DW"),N=i("EasH"),M=i("FWc3"),K=i("4+be");function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw s}}return i}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}i.d(t,"Emoji",function(){return P});var P={opts:{},raw:{},last:0,shownId:!1,hasNewStickers:!1,preventMouseOver:!1,stickerPacksToLoad:[],ttShift:45,favoriteAvailable:!1,favoriteRemindOn:!1,favoriteRemindOff:!1,favoriteLimit:20,favoriteLimitNoticed:!1,stickerSizes:{},stickers:{},TAB_EMOJI:0,TAB_RECENT_STICKERS:-1,TAB_FAVORITE_STICKERS:-2,CLICK_DELAY:500,SORTED_EMOJI_SECTIONS_CODES:[-1,1,3,8,2,4,5,6,7,9],CACHED_HEIGHT_PROP:"_emojiHeight",CACHED_WIDTH_PROP:"_emojiWidth",BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY:150,SHOW_TT_TIMEOUT:100,HIDE_TT_TIMEOUT:300,SHOWN_TT_CLS:"emoji_tt_shown",STICKER_REFERRERS:{RECENT:"recent",FAVORITE:"favourite",KEYBOARD:"keyboard",STORY_KEYBOARD:"story_keyboard"},DELETE_FAV_STICKER_ELEMENTS_DELAY:500,FAV_ICON_TT_MIN_HEIGHT:35,SUGGESTION_WORD_MAX_LENGTH:256,logHintsDelay:0,tabDefaultId:0,stickersKeywordsExpire:36e5*(6+2*Math.random()),init:function(e,t){var i=P.last;P.tabDefaultId=P.TAB_RECENT_STICKERS,t.txt=e,t.id=i,t.fieldWrap=gpeByClass("_emoji_field_wrap",e),t.emojiWrap=domByClass(t.fieldWrap,"_emoji_wrap"),t.emojiBtn=domByClass(t.emojiWrap,"_emoji_btn"),t.emojiWrap&&Object(m.data)(t.emojiWrap,"optId",i),e.emojiId=i,t.lastLoadedEmojiCategoriesIdxes={},t.preventDoubleClick=vkNow(),t.deletedFavoriteStickers=[],t.deleteFavoriteStickersTimeout=null,t.suggestions=new L(t.suggestionsConfig);var o=Object(d.isRetina)()?128:64;if(P.stickerSizes[o]=!0,t.forceTxt)t.editable=0,placeholderInit(e);else{if(t.editable=1,setTimeout(function(){placeholderInit(e,{editable:1,editableFocus:P.editableFocus,global:t.global}),t.shouldFocus&&P.editableFocus(e,!1,!0)},0),browser.mozilla)try{document.execCommand("enableObjectResizing",!1,!1),cur.destroy.push(function(){document.execCommand("enableObjectResizing",!1,!0)})}catch(e){}addEvent(window,"mousemove",P.preventMouseOverHandle),addEvent(e,browser.opera&&!browser.chrome?"click":"mousedown",function(o){if(o.target&&"IMG"==o.target.tagName&&P.getCode(o.target))return P.editableFocus(e,o.target,o.offsetX>8),cancelEvent(o);P.shown&&P.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!0)}),t.noLineBreaks&&addEvent(e,"blur",function(t){e.textContent||e.innerText||each(geByTag("br",e),function(e,t){re(t)})}),addEvent(e,"keypress keydown keyup input paste",function(o){if(o.canceled)return!1;if("keydown"===o.type){t.onChange&&(P.raw[i]=e.innerHTML);var r=t.ctrlSend?t.ctrlSend():t.noEnterSend;if(o.keyCode==KEY.RETURN||10==o.keyCode){if(t.forceEnterSend&&t.onSend)return t.onSend(),cancelEvent(o);var s=cur.ctrl_submit&&!t.noCtrlSend;if((s||r)&&(o.ctrlKey||browser.mac&&o.metaKey)||!s&&!o.shiftKey&&!(o.ctrlKey||browser.mac&&o.metaKey)){var n=Object(m.data)(e,"composer");if(!P.emojiEnter(i,o)||!P.stickerHintMove(o)||n&&n.wdd&&isVisible(n.wdd.listWrap))return!1;if(!r||o.ctrlKey||browser.mac&&o.metaKey)return P.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!0),t.onSend&&t.onSend(),cancelEvent(o)}if(t.noLineBreaks)return cancelEvent(o)}if(o.ctrlKey&&o.keyCode==KEY.RETURN){var a=this.value;if(t.editable)P.insertHTML("<div><br/></div>");else{if("number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd){var c=this.selectionStart;this.value=a.slice(0,c)+"\n"+a.slice(this.selectionEnd),this.selectionStart=this.selectionEnd=c+1}else if(document.selection&&document.selection.createRange){this.focus();var d=document.selection.createRange();d.text="\r\n",d.collapse(!1),browser.opera&&!browser.chrome&&(d.moveEnd("character",0),d.moveStart("character",0)),d.select()}e.autosize.update(),setTimeout(function(){e.autosize.update()},0)}return!1}var u=Object(x.hasAccessibilityMode)()&&Object(l.partConfigEnabled)("emoji_tooltip_a11y_mode");if(o.keyCode===KEY.TAB&&!(o.ctrlKey||browser.mac&&o.metaKey)&&!u){var f=geByClass1("_sticker_hints",domPN(t.txt));if(f&&isVisible(f)){var _=geByClass1("over",f);if(_?P.stickerHintKeyOut(i,_):P.stickerHintKeyOver(i,geByClass1("emoji_sticker_item",f)),!P.shown)return cancelEvent(o)}return P.shown?(P.editableFocus(e,!1,!0,void 0,!0),P.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!0)):P.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!1,!0,void 0,!0),cancelEvent(o)}if(o.keyCode==KEY.ESC){var v=geByClass1("_sticker_hints",domPN(t.txt)),p=!1;if(v&&isVisible(v)&&(P.stickerHintKeyOut(i,geByClass1("emoji_sticker_item",v)),P.stickersHintsHide(v,t,100),p=!0),P.shown&&(P.editableFocus(e,!1,!0,void 0,!0),P.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!0),p=!0),p)return cancelEvent(o);if(t.onEsc)return t.onEsc(o)}}return"paste"===o.type?(P.onEditablePaste(e,t,i,o),t.checkEditable&&setTimeout(t.checkEditable.pbind(i,e),0),P.checkStickersKeywords(i,t)):"keyup"===o.type?(!t.noLineBreaks||e.textContent||e.innerText||each(geByTag("br",e),function(e,t){re(t)}),t.checkEditable&&t.checkEditable(i,e),P.checkStickersKeywords(i,t),t.onChange&&(P.raw[i]!=e.innerHTML&&P.onChange(t),delete P.raw[i])):"keydown"!==o.type&&"input"!==o.type||(t.checkEditable&&setTimeout(t.checkEditable.pbind(i,e),0),P.checkStickersKeywords(i,t)),t.onKeyAction&&t.onKeyAction(o),cur.onReplyFormSizeUpdate&&cur.onReplyFormSizeUpdate(o),!0})}return window.Notifier&&Notifier.addRecvClbk("emoji",0,P.lcRecv,!0),P.initStickersKeywords(),P.initPromotedStickerUrls(),P.checkNewStickers(t),P.opts[P.last]=t,P.last++},setSuggestionsConfig:function(e,t){P.opts[e].suggestions.setConfig(t)},onChange:function(e){Object(T.isFunction)(e.onChange)&&setTimeout(e.onChange,0)},preventMouseOverHandle:function(){P.preventMouseOver=!1},lcRecv:function(e){switch(e.act){case"updateTabs":P.updateTabs(e.newStickers,e.keywords)}},correctCaret:function(e){var t=e?function(e){var t=e.getBoundingClientRect(),i=null,o=null;if(t.top===t.bottom)return{left:0,top:0,bottom:0};if(document.selection)(i=(o=document.selection.createRange()).getClientRects()||[]).length||(o.text="_",o.moveStart("character",-1),i=o.getClientRects(),o.text=""),i=i[i.length-1];else if(window.getSelection){var r=getSelection();if(r.anchorNode){if((o=r.getRangeAt(0)).collapsed){var s=o.startOffset;o.setStart(o.startContainer,0),i=o.getClientRects(),o.setStart(o.startContainer,s)}i=i&&i.length?i[i.length-1]:{right:t.left,top:t.top,bottom:t.top}}else i={right:0,top:0,bottom:0}}return{left:i.right-t.left,top:i.top-t.top,bottom:i.bottom-t.top}}(e).bottom:0;(t<0||t>e.offsetHeight)&&(e.scrollTop+=t-e.offsetHeight)},insertWithBr:function(e,t){if(t){var i=t.replace(/\n/g,"<br/>"),o=ce("div",{innerHTML:i});P.cleanCont(o),P.insertHTML(o.innerHTML)}},insertWithoutNL:function(e,t){if(t){var i=t.replace(/\n/g,""),o=ce("div",{innerHTML:i});P.cleanCont(o),P.insertHTML(o.innerHTML)}},focusTrick:function(e,t,i,o,r){r||(r=e);var s=ce("TEXTAREA",{className:"emoji_tmp_textarea"});e.parentNode.appendChild(s),s.focus(),setTimeout(function(){var n=r.scrollTop;re(s),e.focus(),r.scrollTop=n,P.setRange(o),t(clean(val(s))),i(e)},0)},finalizeInsert:function(e){P.cleanCont(e),setTimeout(P.correctCaret.pbind(e),10)},getClipboard:function(e){return e.clipboardData?clean(e.clipboardData.getData("text")):!!window.clipboardData&&clean(window.clipboardData.getData("Text"))},processImagePaste:function(e,t,i,o){if(null!=e.clipboardData){var r=function(){var r=e.clipboardData;function s(e){if(!e.match(/^webkit\-fake\-url\:\/\//)){var r=new Image;return r.crossOrigin="anonymous",r.onload=function(){var e=document.createElement("canvas");e.width=r.width,e.height=r.height,e.getContext("2d").drawImage(r,0,0,e.width,e.height),e.toBlob(function(e){!function(e){var o,r;if(e.name=e.filename="upload_"+(new Date).toISOString()+"_"+irand(0,100)+".png",hasClass(t,"_im_text")){if(i.uploadActions)return void i.uploadActions.paste([e])}else o="post_field"==t.id?cur.wallAddMedia:(r=Object(m.data)(t,"composer"))&&r.addMedia;o&&Object(T.isFunction)(i.initUploadForImagePasteCallback)&&i.initUploadForImagePasteCallback(t,o,e)}(e)},"image/png"),o(!0)},r.src=e}}if(r.items){for(var n=!1,a=0,c=r.items.length;a<c;a++){var l=r.items[a];if(l.type.match(/^image\//)){var d=new FileReader;d.onload=function(e){return s(e.target.result)},d.readAsDataURL(l.getAsFile()),n=!0}else if("text/plain"===l.type)return{v:o()}}return{v:n}}if(-1!==Array.prototype.indexOf.call(r.types,"text/plain"))return{v:o()};!function(e){for(var i=Math.floor(1e3*Math.random()),r=geByTag("img",t),s=0,n=r.length;s<n;s++){r[s]["_before_paste_"+i]=!0}setTimeout(function(){for(var r=geByTag("img",t),s=!1,n=0,a=r.length;n<a;n++){var c=r[n];c["_before_paste_"+i]||(e(c.src),re(c),s=!0)}s||o()},1)}(function(e){return s(e)})}();if("object"==typeof r)return r.v}else o()},onEditablePaste:function(e,t,i,o,r){var s=!1;"true"===e.getAttribute("contenteditable")&&(s=P.getRange());var n=this.getClipboard(o),a=n&&s&&!r;o.clipboardData&&inArray("text/html",o.clipboardData.types)&&inArray("Files",o.clipboardData.types)&&cancelEvent(o),(this.processImagePaste(o,e,t,function(i){i||(a?(t.noLineBreaks?this.insertWithoutNL(s,n):this.insertWithBr(s,n),setTimeout(this.finalizeInsert.bind(this,e),0)):s&&this.focusTrick(e,t.noLineBreaks?this.insertWithoutNL.pbind(s):this.insertWithBr.pbind(s),this.finalizeInsert.bind(this,e),s))}.bind(this))||a)&&cancelEvent(o),P.onChange(t)},cleanCont:function(e){for(var t=e.firstChild;t;){var i=t.nextSibling;switch(t.nodeType){case 1:if("tmp_paste_cont"==t.id)break;if("DIV"==t.tagName||"P"==t.tagName||"SPAN"==t.tagName)t.setAttribute("style",""),t.className="",t.id="",P.cleanCont(t);else if("IMG"==t.tagName)P.getCode(t)||re(t);else if("BR"!=t.tagName){var r=P.editableVal(t,{saveEmoji:!0}),n=cf(clean(r).replace(/\n/g,"<br/>"));t.parentNode.replaceChild(n,t)}break;case 3:var a=clean(t.textContent||t.innerText),c=Object(o.emojiRegex)();a&&a.match(c)&&(a=a.replace(c,s.emojiReplace),t.parentNode.replaceChild(cf(a),t))}t=i}},focus:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];P.editableFocus(e,!1,!0);var o=i||e.parentNode;if(t){var r=getXY(o)[1],s=scrollGetY(),n=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:boxLayerBG.offsetHeight,a=getSize(o)[1];s+n<r+a?scrollToY(r-n+a+60,100):s>r&&scrollToY(r-60,100)}},destroy:function(e){if(P.opts.hasOwnProperty(e)){var t=P.opts[e];t.txt&&t.txt.blur(),t.imagesLoader&&t.imagesLoader.destroy(),e===P.shownId&&(P.shownId=!1,P.shown=!1),delete P.opts[e]}},editableFocus:function(e,t,i,o,r){if(!e||r&&document.activeElement===e)return!1;if((e=ge(e)).focus(),e.phonfocus&&e.phonfocus(),void 0!==window.getSelection&&void 0!==document.createRange){var s=window.getSelection();if(!browser.opera||browser.chrome||i){var n=document.createRange();t?n.selectNode(t):n.selectNodeContents(e),browser.mozilla&&"<br>"===e.innerHTML&&(e.innerHTML=""),o||n.collapse(!i),(s=window.getSelection()).removeAllRanges(),s.addRange(n)}else s.collapse(t||e,0)}else if(void 0!==document.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(t||e),a.collapse(!i),a.select()}},getRange:function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},setRange:function(e){if(window.getSelection){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else document.selection&&e.select&&e.select()},val:function(e,t){if(void 0===t)return P.editableVal(e);t=(t=Object(s.emojiToHTML)(t,!0)).replace(/ $/,"&nbsp;"),e.setValue?(e.setValue(t),e.phonblur&&e.phonblur()):e.innerHTML=t,P.updateStickersHints();var i=Object(m.data)(e,"composer");return i&&window.Composer&&setTimeout(Composer.updateAutoComplete.pbind(i)),!0},editableVal:function(e,t){if(!e)return"";if("TEXTAREA"==e.tagName)return val(e);for(var i,o=e.firstChild,r="",s=new RegExp("^(DIV|P|LI|OL|TR|TD|BLOCKQUOTE)$");o;){switch(o.nodeType){case 3:r+=i=o.data.replace(/^\n|\n$/g," ").replace(/[\n\xa0]/g," ").replace(/[ ]+/g," ");break;case 1:if(i=P.editableVal(o),o.tagName&&o.tagName.match(s)&&i){"\n"!=i.substr(-1)&&(i+="\n");for(var n=o.previousSibling;n&&3==n.nodeType&&""==trim(n.nodeValue);)n=n.previousSibling;!n||n.tagName&&(n.tagName.match(s)||"BR"==n.tagName)||(i="\n"+i)}else if("IMG"==o.tagName){var a=P.getCode(o);a&&(t&&t.saveEmoji?i+=P.getEmojiHTML(a):i+=P.codeToChr(a))}else"BR"==o.tagName&&(i+="\n");r+=i}o=o.nextSibling}return r},cssEmoji:o.EMOJI_HINTS,getEmojiHTML:s.getEmojiHTML,codeToChr:r.emojiByteHexToSymbol,checkEditable:function(e,t,i){var o=t.scrollHeight,r=P.opts[e];if(!r)return!1;r.scPaddings||(r.scPaddings=intval(getStyle(t,"paddingTop"))+intval(getStyle(t,"paddingBottom"))),o-=r.scPaddings;var s=r.tt;if(o>i.height+(browser.mozilla&&r.isChat?0:5)){if(!r.isSized){setStyle(t,{height:i.height+"px",overflowY:"auto"});var n=geByClass1("emoji_smile",r.controlsCont),a=geByClass1("emoji_smile_icon_promo",r.controlsCont),c=ge("im_upload"),l=Object(A.sbWidth)();r.ttWrap&&(l+=getSize(r.ttWrap)[0]-(getXY(r.emojiBtn)[0]-getXY(r.ttWrap)[0])),setStyle(n,vk.rtl?{left:1+l}:{right:1+l}),a&&setStyle(a,vk.rtl?{left:2+l}:{right:2+l}),c&&setStyle(c.parentNode,vk.rtl?{left:1+l}:{right:1+l}),s&&setStyle(s,vk.rtl?{left:(r.ttDiff||31)+l}:{right:(r.ttDiff||31)+l}),r.isSized=!0}}else if(r.isSized){setStyle(t,{height:"auto",overflowY:"hidden"});var d=geByClass1("emoji_smile",r.controlsCont),m=geByClass1("emoji_smile_icon_promo",r.controlsCont),u=ge("im_upload");setStyle(d,vk.rtl?{left:1}:{right:1}),m&&setStyle(m,vk.rtl?{left:2}:{right:2}),u&&setStyle(u.parentNode,vk.rtl?{left:1}:{right:1}),s&&setStyle(s,vk.rtl?{left:r.ttDiff||31}:{right:r.ttDiff||31}),r.isSized=!1}r.onResize&&r.onResize()},stickersHintsShow:function(e,t,i){(isVisible(e)||fadeIn(e,i),t.stickerEventsInited)||((e&&geByClass1("_sticker_hints_inner",e)).addEventListener("wheel",P.onWheelStickersHints),addEvent(document,"keydown",P.stickerHintMove),t.onHintsMouseDown=function(){t.hintsClicked=!0,setTimeout(function(){delete t.hintsClicked},0)},addEvent(e,"mousedown",t.onHintsMouseDown),t.txt&&(t.onTxtFocus&&(removeEvent(t.txt,"focus",t.onTxtFocus),delete t.onTxtFocus),t.onTxtBlur=function(o){if(t.hintsClicked)return cancelEvent(o),!0;P.stickersHintsHide(e,t,i)},addEvent(t.txt,"blur",t.onTxtBlur)),t.stickerEventsInited=!0);P.checkStickersHintsSize(e,t)},stickersHintsHide:function(e,t,i){(fadeOut(e,i),removeEvent(document,"keydown",P.stickerHintMove),t.onHintsMouseDown&&removeEvent(e,"mousedown",P.onHintsMouseDown),t.onHintsWheel)&&(e&&geByClass1("_sticker_hints_inner",e)).removeEventListener("wheel",P.onWheelStickersHints);t.txt&&(t.onTxtBlur&&(removeEvent(t.txt,"blur",t.onTxtBlur),delete t.onTxtBlur),t.onTxtFocus&&removeEvent(t.txt,"focus",t.onTxtFocus),t.onTxtFocus=function(){var e=t.txt&&geByClass1("_sticker_hints",domPN(t.txt));e&&!isVisible(e)&&(delete t.stickerHintsString,P.checkStickersKeywords(t.id,t,!1))},addEvent(t.txt,"focus",t.onTxtFocus)),delete t.stickerEventsInited,delete P.shownHintId,P.sendHintsLog()},stickerHintOver:function(e){P.stickerHintOut(e),addClass(e,"over")},stickerHintOut:function(e){each(geByClass("over",domPN(e)),function(){removeClass(this,"over")})},stickerHintClick:function(e,t,i,o){var r=P.opts[e]||{},s=r.txt,n=s&&geByClass1("_sticker_hints",domPN(s)),a="suggestion_"+P.stickerSuggestionQuery;return"stories"===r.ref&&(a="story_suggestion_"+P.stickerSuggestionQuery),t<0?P.previewSticker(!1,o,{stickerId:-t,sticker_referrer:a}):(val(s,""),P.stickerClick(e,t,256,i,o,a),r.checkEditable&&r.checkEditable(e,s)),P.stickersHintsHide(n,r,0),!1},stickerHintKeyOver:function(e,t){P.stickerHintOver(t),P.shownHintId=e},stickerHintKeyOut:function(e,t){P.stickerHintOut(t),delete P.shownHintId},stickerHintMove:function(e){var t=P.shownHintId;if(void 0===t)return!0;var i=P.opts[t],o=i&&geByClass1("_sticker_hints",domPN(i.txt));if(o&&isVisible(o)){var r=geByClass1("over",o)||geByClass1("emoji_sticker_item",o);switch(e.keyCode){case KEY.LEFT:return(r=domPS(r))&&(P.stickerHintOver(r),P.checkStickersHintsScroll(r)),cancelEvent(e),!1;case KEY.RIGHT:return(r=domNS(r))&&(P.stickerHintOver(r),P.checkStickersHintsScroll(r)),cancelEvent(e),!1;case KEY.ENTER:return r.click(),cancelEvent(e),!1}}return!0},checkStickersHintsSize:function(e,t,i){i&&(addClass(e,"_margin_transition"),Object(m.removeClassDelayed)(e,"_margin_transition")),setStyle(e,{marginLeft:0});var o=getXY(e),r=getSize(e),s=P.getEmojiTtXY(t.tt);t.tt&&s&&s[0]&&o[0]+r[0]+10>s[0]&&o[1]+r[1]>s[1]&&setStyle(e,{marginLeft:s[0]-o[0]-r[0]-10}),domFC(e)||P.stickersHintsHide(e,t,0)},getEmojiTtXY:function(e){return e&&hasClass(e,P.SHOWN_TT_CLS)?getXY(e):[0,0]},hintaches:{},hintachesNotFoundStickers:{},checkHintaches:function(e,t,i){if(Object(l.partConfigEnabled)("hintach"))return P.hintaches[e]?requestAnimationFrame(()=>P.renderHintaches(e,t,i,P.hintaches[e])):void ajax.post("/hintach",{query:e},{onDone:o=>{P.hintaches[e]=o,P.renderHintaches(e,t,i,P.hintaches[e])}})},onHintachItemClick:function(e){var t=e.currentTarget.dataset.hint,i=parseInt(e.currentTarget.parentNode.dataset.opt);if(t&&!isNaN(i)){var o=P.opts[i]||{},r=o.txt,s=r&&geByClass1("_sticker_hints",domPN(r)),n=function(e){if(!e||"string"!=typeof e)return null;var t=e.match(/(photo|doc)(-?\d+)_(\d+)/);if(!t)return null;var i=t[1],o=parseInt(t[2]),r=parseInt(t[3]),s=[o,r].join("_");return{type:i,ownerId:o,id:r,rawId:s}}(t);return n&&o.onHintachSend&&(val(r,""),o.onHintachSend(n.type,n.rawId),o.checkEditable&&o.checkEditable(i,r),P.stickersHintsHide(s,o,0)),!1}},renderHintaches:function(e,t,i,o){var r=t.txt,s=geByClass1("_sticker_hints",domPN(r)),n=isArray(o.photos)&&o.photos.length||isArray(o.docs)&&o.docs.length;if(e&&t.stickerHintsString&&n){var a=s&&geByClass1("_sticker_hints_inner",s);if(!a||t.noStickers)return!1;P.clearHintsLog(),P.hintachesNotFoundStickers[e]&&(a.innerHTML="");var l=a.querySelector(".Hintach");l||(l=a.appendChild(ce("div",{className:"Hintach"}))),l.setAttribute("data-opt",t.id),l.innerHTML="";var d=64*window.devicePixelRatio,m=64*window.devicePixelRatio;(o.photos||[]).forEach(e=>{var t=function(e,t,i){if(!e||!t||!i)return null;var o=Object.values(e).sort((e,t)=>e[1]-t[1]||e[2]-t[2]);return o.find(e=>e[1]>=t&&e[2]>=i)||o[parseInt(o.length/2)]||o[0]}(e.sizes,d,m);if(t){var i=F(t,3),o=i[0],r=F(c(i[1],i[2]),2),s=r[0],n=r[1],a=ce("div",{className:"Hintach__item Hintach__item--photo"});a.setAttribute("data-hint","photo"+e.id),a.appendChild(ce("div",{className:"Hintach__itemThumb"},{width:s,height:n,backgroundImage:`url(${o})`})),a.onclick=P.onHintachItemClick,l.appendChild(a)}}),(o.docs||[]).forEach(e=>{if(e.preview&&(e.preview.video||e.preview.graffiti)){var t=F(e.preview.video||e.preview.graffiti,3),i=t[0],o=F(c(t[1],t[2]),2),r=o[0],s=o[1],n=ce("div",{className:"Hintach__item Hintach__item--doc"});n.setAttribute("data-hint","doc"+e.id);var a=n.appendChild(ce(e.preview.video?"video":"img",{className:"Hintach__itemPreview",src:i},{width:r,height:s}));e.preview.video&&(n.appendChild(ce("div",{className:"Hintach__itemType",innerHTML:"GIF"})),a.autoplay=!0,a.loop=!0),n.onclick=P.onHintachItemClick,l.appendChild(n)}}),l.childElementCount>0&&(P.stickersHintsShow(s,t,100),a.scrollLeft=0,P.checkStickersHintsScroll(s,a.scrollLeft))}},onMoneyTransferSuggestionClick:function(e,t,i){var o=P.opts[e],r=o.txt.parentNode.querySelector("._sticker_hints");if(P.stickersHintsHide(r,o,0),"send"===t&&o.suggestions.isMoneySendEnabled()||"request"===t&&o.suggestions.isMoneyRequestEnabled()){var s=o.suggestions.config,n=s.fromId,a=s.peer;w.onClick(n,a,t,i,{onSendStart:()=>{o.clearText&&o.clearText()}});var c=P.moneyTransferTextMatch&&P.moneyTransferTextMatch.input||"";statlogsValueEvent("stickers_money_transfer_suggestions","select",[t],c)}},renderMoneyTransferSuggestions:function(e,t){var i=P.opts[e],o=Object(d.isRetina)()?128:64,r={};return i.suggestions.isMoneyRequestEnabled()?r.request=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="request"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'request', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/request/${o}.png" />\n      </a>`:r.request="",i.suggestions.isMoneySendEnabled()?r.send=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="send"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'send', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/send/${o}.png" />\n      </a>`:r.send="",t.request?r.request+r.send:r.send+r.request},checkStickersKeywords:function(e,t,i){if(t.noStickers||!window.stickersKeywords||!window.stickersKeywordsData||!window.stickersKeywordsData.length)return!1;var o=i?0:100,r=t.txt,s=geByClass1("_sticker_hints",domPN(r)),n=function(i,o){if(P.stickers[P.TAB_RECENT_STICKERS]){var r=P.sortStickersHints(window.stickersKeywords[i]),n=P.stickers[P.TAB_RECENT_STICKERS].promoted,a="";o&&(a+=P.renderMoneyTransferSuggestions(e,o)),each(r,function(){a+=P.render.stickerHintRs(e,this,n[this])}),t.suggestions.isBotLinkEnabled()&&(a+=P.renderSuggestionsBotLink(e)),P.showStickersHints(s,t,a)}},a=function(){var a=t.suggestions.getQueries(P.val(r));if(a.length){var c=a[0],l=a[a.length-1],d=t.suggestions.isMoneyTransferEnabled()&&w.match(c,1);if(d&&(a=[w.DEFAULT_QUERY]),P.moneyTransferTextMatch=d,!s&&!(s=P.initStickersHints(r)))return!1;if(c!=t.stickerHintsString){var m=a.find(e=>e&&window.stickersKeywords[e]&&window.stickersKeywords[e].length);if(P.stickerSuggestionQuery=m,m)if(P.stickers[P.TAB_RECENT_STICKERS])n(m,d);else{var u=t.onRecentEmojiUpdate;t.onRecentEmojiUpdate=function(e){u&&u(),e&&(u?t.onRecentEmojiUpdate=u:delete t.onRecentEmojiUpdate,n(m,d))},P.emojiLoadMore(e)}else P.hintachesNotFoundStickers[l]=!0,P.stickersHintsHide(s,t,o);!d&&l&&l.length<20&&t.onHintachSend&&(clearTimeout(t.hintachCheckTimeout),t.hintachCheckTimeout=setTimeout(()=>{P.checkHintaches(l,t,i)},160)),t.stickerHintsString=c}}};i?a():(clearTimeout(t.stickerHintTT),t.stickerHintTT=setTimeout(a,s&&isVisible(s)?0:200))},showStickersHints:function(e,t,i){var o=e&&geByClass1("_sticker_hints_inner",e);if(!o||t.noStickers)return!1;P.clearHintsLog(),val(o,i),P.stickersHintsShow(e,t,100),o.scrollLeft=0,P.checkStickersHintsScroll(e,o.scrollLeft)},checkStickersHintsScroll:function(e,t){var i=domClosest("_sticker_hints",e),o=i&&geByClass1("_sticker_hints_inner",i),r=i&&geByClass1("_sticker_left",i),s=i&&geByClass1("_sticker_right",i);if(!o)return!1;var n=getSize(r)[0],a=getSize(s)[0];if(hasClass(e,"emoji_sticker_item")){var c=e.offsetLeft-8-n,l=e.offsetLeft+getSize(e)[1]+2+a-o.clientWidth;o.scrollLeft>c&&(o.scrollLeft=c),o.scrollLeft<l&&(o.scrollLeft=l),t=o.scrollLeft}var d=t>0,m=t+o.clientWidth<o.scrollWidth;toggle(r,d),toggleClass(i,"sticker_hints_left_pad",d),toggle(s,m),toggleClass(i,"sticker_hints_right_pad",m),t=void 0===t?o.scrollLeft:t;var u=o.querySelectorAll(".emoji_sticker_item"),f=d?n+8:0,_=m?a+2:0,v=Array.from(u).filter(e=>e.offsetLeft-f>=t&&e.offsetLeft+e.offsetWidth+_-o.clientWidth<=t);P.logHints(v.map(e=>intval(e.getAttribute("data-sticker-id"))).filter(e=>e));var p=v.map(e=>e.getAttribute("data-money-transfer-type")).filter(e=>e);if(p.length){var h=P.moneyTransferTextMatch&&P.moneyTransferTextMatch.input||"";statlogsValueEvent("stickers_money_transfer_suggestions","show",p,h)}},logHints:function(e){P.logHintsTimeout&&clearTimeout(P.logHintsTimeout),P.logHintsTimeout=setTimeout(()=>{P.hintsLogBuffer=e.reduce((e,t)=>(e[t]=1,e),P.hintsLogBuffer||{})},P.logHintsDelay)},clearHintsLog:function(){P.logHintsTimeout&&clearTimeout(P.logHintsTimeout),P.hintsLogBuffer={}},sendHintsLog:function(){var e=P.hintsLogBuffer&&Object.keys(P.hintsLogBuffer),t=window.cur&&window.cur.emojiHintsSendLogHash;e&&e.length&&t&&ajax.post("stickers.php",{act:"log_hints",sticker_ids:e,hash:t}),P.clearHintsLog()},scrollStickersHints:function(e,t,i){var o=domClosest("_sticker_hints",e),r=o&&geByClass1("_sticker_hints_inner",o),s=o&&geByClass1("_sticker_left",o),n=o&&geByClass1("_sticker_right",o);if(!r)return!1;var a=r.scrollLeft+t*(r.clientWidth-2*getSize(e)[0]),c=geByClass("emoji_sticker_item",r);each(c,function(e,i){return t>0&&i.offsetLeft-8-getSize(s)[0]>a?(a=c[e-1]&&c[e-1].offsetLeft-8-getSize(s)[0]||a,!1):t<0&&i.offsetLeft+getSize(i)[1]+2+getSize(n)[0]-r.clientWidth>a?(a=i.offsetLeft+getSize(i)[1]+2+getSize(n)[0]-r.clientWidth||a,!1):void 0}),a=Math.max(0,Math.min(r.scrollWidth-r.clientWidth,a)),animate(r,{scrollLeft:a},{duration:Math.abs(r.scrollLeft-a)+50,transition:Fx.Transitions.easeOutCubic}),P.checkStickersHintsScroll(r,a)},onWheelStickersHints:function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget;t.scrollLeft+=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX,P.checkStickersHintsScroll(t,t.scrollLeft)},sortStickersHints:function(e){var t=[];P.stickers[-1]&&(t=P.stickers[-1].stickers);var i={},o=[];return each(t,function(){inArray(this[0],e)&&!i[this[0]]&&(o.push(this[0]),i[this[0]]=1)}),each(e,function(){i[this]||o.push(this)}),o},initStickersHints:function(e){return!!e&&domPN(e).insertBefore(se('<div class="_sticker_hints sticker_hints_tt">\n      <div class="sticker_hints_arrow sticker_left _sticker_left" onmousedown="Emoji.scrollStickersHints(this, -1, event);cancelEvent(event);" onclick="cancelEvent(event);"></div>\n      <div class="_sticker_hints_inner sticker_hints_inner"></div>\n      <div class="sticker_hints_arrow sticker_right _sticker_right" onmousedown="Emoji.scrollStickersHints(this, 1, event);cancelEvent(event);" onclick="cancelEvent(event);"></div>\n    </div>'),e)},updateStickersHints:function(e){P.opts&&each(P.opts,function(t,i){e&&delete i.stickerHintsString,P.checkStickersKeywords(t,i,!0)})},renderSuggestionsBotLink(e){var t=P.opts[e].suggestions,i=Object(d.isRetina)()?128:64;return`<a\n    class="emoji_sticker_item"\n    href="${t.getBotLinkUrl()}"\n    onClick="Emoji.onSuggestionsBotLinkClick(event, ${e});"\n    target="_blank">\n    <img class="emoji_sticker_image" src="${t.getBotLinkImageUrl(i)}" />\n  </a>`},onSuggestionsBotLinkClick(e,t){e.stopPropagation();var i=P.opts[t].suggestions;statlogsValueEvent(i.getBotLinkClickStatName(),0,...i.getBotLinkClickStatKeys())},initStickersKeywords:function(){if(!window.stickersKeywordsData){var e=ls.get("stickers_keywords");e&&e.time&&e.time>vkNow()-P.stickersKeywordsExpire&&(window.stickersKeywordsData=e.keywords)}window.stickersKeywordsData&&P.setStickersKeywords(window.stickersKeywordsData)},initPromotedStickerUrls:function(){if(!window.promotedStickerUrls){var e=ls.get("promoted_stickers_urls");if(e&&e.time&&e.time>vkNow()-P.stickersKeywordsExpire)window.promotedStickerUrls=e.stickerUrls;else{ajax.post("al_im.php",{act:"get_promoted_stickers"},{onDone:function(e){ls.set("promoted_stickers_urls",{time:vkNow(),stickerUrls:e}),window.promotedStickerUrls=e}})}}},cachedStickersKeywordsTime:function(){var e=ls.get("stickers_keywords");return e&&e.time?Math.floor(e.time/1e3):0},setStickersKeywords:function(e,t){if(!e)return!1;window.stickersKeywords={};var i=ce("div"),o=[],r="";if(e.forEach(function(e){var t=e.words||[],i=e.user_stickers||[],s=e.promoted_stickers||[],n=i.concat(s.map(function(e){return-e}));t.forEach(function(e){r+="\n"+e,o.push(n)})}),val(i,r),(r=i.textContent||i.innerText)&&r.slice("\n".length).split("\n").forEach(function(e,t){window.stickersKeywords[e]=o[t]}),!P.stickers[P.TAB_RECENT_STICKERS]){var s=ls.get("recent_stickers");s&&(P.stickers[P.TAB_RECENT_STICKERS]=s)}t&&(ls.set("stickers_keywords",{time:vkNow(),keywords:e}),P.updateStickersHints(!0))},emojiEnter:function(e,t){var i=P.opts[e],o=(i.ctrlSend?i.ctrlSend():i.noEnterSend)||cur.ctrl_submit&&!i.noCtrlSend;if(i.emojiFocused&&i.emojiOvered&&i.openedByTabKey&&(o?!(t.ctrlKey||browser.mac&&t.metaKey):!t.shiftKey)){if(0===i.curTab){var r=geByTag1("img",i.emojiOvered)||geByTag1("i",i.emojiOvered);P.addEmoji(e,P.getCode(r),i.emojiOvered)}return cancelEvent(t)}return!0},insertHTML:function(e){if(browser.msie&&parseInt(browser.version)<12)if(document.selection){var t=document.selection.createRange();t.pasteHTML&&t.pasteHTML(e)}else{var i=document.getSelection().getRangeAt(0),o=document.createElement("span");i.surroundContents(o),o.innerHTML=e,i.collapse(!1)}else e&&document.execCommand("insertHTML",!1,e)},addEmoji:function(e,t,i){if(!1===e||!1===t)return!1;var o=P.opts[e];if(!(vkNow()-o.ttShowT<P.CLICK_DELAY)){if(o.editable){var r=P.getEmojiHTML(t,P.codeToChr(t),!0),s=o.txt,n=!!window.getSelection&&window.getSelection(),a=!1;if(n&&n.rangeCount){var c=n.getRangeAt(0);a=c.commonAncestorContainer?c.commonAncestorContainer:c.parentElement?c.parentElement():c.item(0)}for(var l=a;l&&l!=s;)l=l.parentNode;var d=s.lastChild||{};browser.mozilla&&"BR"==d.tagName&&!d.previousSibling&&re(s.lastChild),l||P.editableFocus(s,!1,!0),P.insertHTML(r);var u=geByClass("emoji",s);for(var f in u.push.apply(u,geByClass("emoji_css",s)),u)if(u.hasOwnProperty(f)){var _=u[f].previousSibling;if(_&&3==_.nodeType&&_.textContent&&32==_.textContent.charCodeAt(0)){var v=_.previousSibling;v&&3==v.nodeType&&v.textContent&&160==v.textContent.charCodeAt(v.textContent.length-1)&&re(_)}}s.check&&s.check(),setTimeout(P.correctCaret.pbind(s),5),P.onChange(o);var p=Object(m.data)(s,"composer");p&&window.Composer&&Composer.updateAutoComplete(p)}else{var h,k,g,S=o.txt,j=S.value;h=browser.iphone||browser.ipad?P.codeToChr(t):P.cssEmoji[t][1]+" ",null!=S.selectionStart&&null!=S.selectionEnd?(k=S.selectionEnd,S.value=j.slice(0,S.selectionStart)+h+j.slice(k),S.selectionStart=S.selectionEnd=k+h.length):void 0!==document.selection&&void 0!==document.selection.createRange&&(S.focus(),(g=document.selection.createRange()).text=h,g.select())}o.checkEditable&&o.checkEditable(e,o.txt),P.checkStickersKeywords(e,o),o.saveDraft&&o.saveDraft(),o.onEmojiAdded&&o.onEmojiAdded(),P.incrRecentEmojiRate(e,t)}},showShadow:function(){return!(browser.msie&&browser.version<10)},scrollToggleArrow:function(e,t,i,o){var r=geByClass1("emoji_tabs_"+t+"_s",i.tt);o?(e?show:hide)(r):e?fadeIn(r,200):fadeOut(r,200),i[t+"Shown"]=e},scrollTabs:function(e,t){var i=P.opts[e];if(i){var o,r=geByClass1("emoji_tabs_wrap",i.tt),s=r.firstChild.clientWidth-r.clientWidth;if(t){if((o=2==t?r.scrollLeft:r.scrollLeft+170)>=s){o=s;var n=geByClass1("emoji_tabs_r_s",i.tt);fadeOut(n,200),i.rShown=!1,P.scrollToggleArrow(!1,"r",i)}o&&!i.lShown&&P.scrollToggleArrow(!0,"l",i)}t&&2!=t||((o=2==t?r.scrollLeft:Math.max(r.scrollLeft-170,0))<=0&&(o=0,P.scrollToggleArrow(!1,"l",i)),o<s&&!i.rShown&&P.scrollToggleArrow(!0,"r",i)),2!=t&&(i.scrollLeft=o,animate(r,{scrollLeft:o},300))}},scrollToTab:function(e,t){var i=P.opts[t],o=i.tt,r=geByClass1("emoji_tabs_wrap",o),s=geByClass1("emoji_tab_"+e,o);if(s){var n=Object(m.data)(r,"tween");if(!n||!n.isTweening||e!=i.curTab){var a=getSize(s)[0],c=s.offsetLeft,l=getSize(r)[0],d=c-l/2+10;c+a<r.scrollLeft?r.scrollLeft=Math.max(c,r.scrollLeft-l/2):c+a-r.scrollLeft>l&&(r.scrollLeft=Math.min(c+a-r.scrollLeft,r.scrollLeft+l/2)),animate(r,{scrollLeft:d},300,function(){P.scrollTabs(t,2)}),P.selectTab(t,e,s)}}},selectTab:function(e,t,i){var o=P.opts[e],r=o.tt,s=geByClass1("emoji_tabs",r),n=geByClass1("emoji_tab_sel",s);removeClass(n,"emoji_tab_sel"),addClass(i,"emoji_tab_sel"),o.curTab=t,cur.stickersTab=t,ls.set("stickers_tab",t)},tabsWheel:function(e,t){cancelEvent(e);var i=P.opts[t],o=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX,r=geByClass1("emoji_tabs_wrap",i.tt),s=r.scrollLeft;r.scrollLeft+=o,s!=r.scrollLeft&&P.scrollTabs(t,2)},show:function(e,t){var i=Object(m.data)(domPN(e),"optId");void 0!==i&&P.ttShow(i,e,t)},hide:function(e,t,i){var o=Object(m.data)(domPN(e),"optId");void 0!==o&&P.ttHide(o,e,t,i)},ttShow:function(e,t,i){var o=P.opts[e];clearTimeout(o.ctt),clearTimeout(o.stt),o.scrolling&&(o.afterScrollFn=!1),o.ttShown||(t?o.obj=t:t=o.obj,o.stt=setTimeout(function(){P.ttClick(e,t,!1,!0,i)},P.SHOW_TT_TIMEOUT))},ttHide:function(e,t,i,o){var r=P.opts[e];if(clearTimeout(r.stt),r.ttShown)if(r.scrolling)r.afterScrollFn=P.ttHide.pbind(e,t,i,o);else{t=t||r.obj||geByClass1("emoji_smile",r.controlsCont);var s=function(){P.ttClick(e,t,!0,!1,i)};o?s():(clearTimeout(r.ctt),r.ctt=setTimeout(s,P.HIDE_TT_TIMEOUT))}},ttClick:function(e,t,i,o,r,s){var n=P.opts[e];if(n&&!(i&&!P.shown||o&&P.shown)&&(t||(t=P.shown||ge(-3==cur.peer?"imw_smile":"im_smile")))){t.tt&&t.tt.destroy&&t.tt.destroy(),!n.tt&&n.sharedTT&&n.sharedTT.emojiTT&&(n.tt=n.sharedTT.emojiTT,n.emojiScroll=n.sharedTT.emojiScroll,n.allEmojiId=n.sharedTT.emojiAllId);var a,c=n.tt;if(!c){var l=ls.get("stickers_tab");l||(l=P.TAB_EMOJI),n.curTab=cur.stickersTab=P.TAB_EMOJI,l==P.TAB_EMOJI||n.noStickers||(P.stickers[P.TAB_RECENT_STICKERS]=ls.get("recent_stickers"),n.curTab=cur.stickersTab=l);var d='<div class="emoji_tabs_l_s" onmousedown="Emoji.scrollTabs('+e+', 0); return cancelEvent(event);" onclick="return cancelEvent(event)"><div class="emoji_sprite emoji_tabs_l_sc"></div><div class="emoji_sprite emoji_tabs_l_si"></div></div><div class="emoji_tabs_r_s" onmousedown="Emoji.scrollTabs('+e+', 1); return cancelEvent(event);" onclick="return cancelEvent(event);"><div class="emoji_sprite emoji_tabs_r_sc"></div><div class="emoji_sprite emoji_tabs_r_si"></div></div>';d+=P.getTabsCode([[0,1]],e),d+='<span class="emoji_tabs_wrap"><span id="emoji_tabs_cont_'+e+'" class="emoji_tabs_cont">',n.noStickers||!1===window.emojiStickers||void 0===window.emojiStickers||(d+=P.getTabsCode(window.emojiStickers,e));var m="",u='onmousedown="Emoji.showStickersStore('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"',f="showTooltip(this, {text: '"+Object(K.getLang)("global_store_stickers")+"', shift: [4,6,6], showdt: 0, black: 1});";n.rPointer?u+=" onmouseover=\"addClass(this.parentNode.parentNode.parentNode, 'emoji_shop_over');"+f+'" onmouseout="removeClass(this.parentNode.parentNode.parentNode, \'emoji_shop_over\');"':u+=' onmouseover="'+f+'"',d+="</span></span>",n.noStickers||(d+='<a class="fl_r emoji_shop" '+u+'><div class="emoji_sprite emoji_shop_icon">'+(P.hasNewStickers?'<div class="emoji_shop_icon_badge">'+Math.abs(P.hasNewStickers)+"</div>":"")+"</div></a>"),P.showShadow()||(m+=" emoji_no_opacity"),(n.noStickers||n.hideStickersInitial)&&(m+=" emoji_no_tabs"),c=ce("div",{id:"emoji_block_"+e,className:"emoji_tt_wrap tt_down"+m,innerHTML:'<div class="emoji_block_cont"><div class="emoji_block_rel"><div class="emoji_list_cont"><div class="emoji_cats_title_helper"></div><div class="emoji_list"><div class="emoji_scroll emoji_scroll_smiles"></div><div class="emoji_scroll emoji_scroll_stickers"></div></div></div></div><div class="emoji_tabs clear_fix">'+d+"</div></div>",onmouseover:function(t){hasClass(c,"emoji_animated")||P.ttShow(e,!1,t)},onmouseout:function(t){hasClass(c,"emoji_animated")||P.ttHide(e,!1,t)}}),n.tt=c,P.reappendEmoji(e,c),P.emojiOver(e,geByClass1("emoji_scroll_smiles",c).firstChild),each(["emoji_tabs_l_s","emoji_tabs_r_s","emoji_tabs_wrap"],function(){addEvent(geByClass1(this,n.tt),"DOMMouseScroll wheel",function(t){P.tabsWheel(t,e)})}),n.sharedTT&&(n.sharedTT.emojiTT=c),P.checkEmojiSlider(n)}if(clearTimeout(n.ttEmojiHide),!1!==P.shownId&&P.shownId!=e&&P.ttClick(P.shownId,geByClass1("emoji_smile",P.opts[P.shownId].controlsCont),!0),P.preventMouseOver=!1,n.emojiExpanded||P.emojiExpand(e,c),P.shown)P.hideTt(c),(a=geByClass1("_sticker_hints",domPN(n.txt)))&&isVisible(a)&&P.checkStickersHintsSize(a,n,!0),P.shown=!1,P.shownId=!1,n.ttShown=!1,n.emojiFocused=!1,n.emojiOvered=!1,cur.onMouseClick=!1,removeEvent(document,"keydown",P.emojiMove),removeClass(t,"emoji_smile_on"),n.onHide&&n.onHide(),P.favorite.deleteFavoriteStickerElements(e);else{if(n.needUpdateRecentStickers&&(P.updateRecentStickers(e),n.needUpdateRecentStickers=!1),!getXY(n.emojiBtn)[0]||!getXY(n.emojiBtn)[1])return;n.openedByTabKey=!!s,P.showTt(c),P.repositionEmoji(e,t,c),(a=geByClass1("_sticker_hints",domPN(n.txt)))&&isVisible(a)&&P.checkStickersHintsSize(a,n,!0),P.shownId=e,P.shown=t,cur.emojiList=geByClass1("emoji_list",c),n.ttShown=!0,n.ttShowT=vkNow(),n.emojiFocused=!0,removeEvent(document,"keydown",P.emojiMove),setTimeout(function(){cur.onMouseClick=function(t){for(var i=t.target;i;){if("im_texts"==i.id||hasClass(i,"emoji_tt_wrap")||hasClass(i,"imw_emoji_wrap"))return!1;i=i.parentNode}P.ttClick(e,!1,!0)},addEvent(document,"keydown",P.emojiMove)},0),addClass(t,"emoji_smile_on"),n.emojiScroll&&n.emojiExpanded&&(n.emojiScroll.update(),browser.msie&&0===n.curTab&&n.emojiOvered&&P.scrollToListEl(e,n.emojiOvered)),P.tabSwitch(n.curTab,n.curTab,e),n.onRecentEmojiUpdate&&n.onRecentEmojiUpdate(!0),n.onShow&&n.onShow()}return each(geByClass("emoji_smile_icon_promo"),function(e,t){removeEvent(geByClass1("emoji_smile_icon",t.parentNode),"mouseover"),re(t),P.noNewStickers=!0}),n.noStickersStore?addClass(geByClass1("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"):removeClass(geByClass1("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"),cancelEvent(r)}},curEmojiKeys:{},curEmojiRecent:{},emojiLoadMore:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,o=P.opts[e];if(!o.emojiMoreSt){o.emojiMoreSt=1,t.act="get_emoji_list",P.stickerPacksToLoad&&(t.sticker_packs_to_load=P.stickerPacksToLoad.join(",")),P.hasNewStickers<0&&(t.new_shown=1);var r=Object.assign(t.sizes||{},P.stickerSizes);t.sizes=r&&Object.keys(r).join(","),ajax.post("al_im.php",t,{onDone:function(t,s,n,a,c,l){if(P.buildStickersIndex(t),void 0!==t[P.TAB_FAVORITE_STICKERS]){var d=t[P.TAB_FAVORITE_STICKERS];P.tabDefaultId=P.TAB_FAVORITE_STICKERS,P.favoriteAvailable=!0,P.favoriteRemindOn=!!d.remind_on,P.favoriteRemindOff=!!d.remind_off,P.favoriteLimit=d.limit,P.favoriteLimitNoticed=d.limit_noticed,P.sendHintsLogHash=c,w.setIntroViewed(l)}a&&extend(cur.lang,a),n?stManager.add([jsc("web/stickers.js")],function(){P.updateEmojiList(t,s,e,o)}):P.updateEmojiList(t,s,e,o),Object.assign(P.stickerSizes,r),Object(T.isFunction)(i)&&i()},onFail:function(){o.emojiMoreSt=0}}),P.curEmojiRecent&&o.onRecentEmojiUpdate&&o.onRecentEmojiUpdate()}},buildStickersIndex:function(e){var t={};if(e)for(var i in e)if(e.hasOwnProperty(i)&&i>0&&e[i].stickers)for(var o=e[i].stickers,r=o.length;r--;){var s=o[r];t[s[0]]={sticker:s,packId:i}}P.stickersById=t},updateEmojiList:function(e,t,i,o){P.stickers=e,o.emojiMoreSt=0,P.stickers[-1]&&(ls.set("recent_stickers",P.stickers[-1]),P.updateRecentEmoji(i)),P.stickers[-2],o.allEmojiId=0,o.sharedTT&&(o.sharedTT.emojiAllId=0),P.onStickersLoad&&(o.afterLoad=1),P.onStickersLoad&&window.emojiStickers&&(P.onStickersLoad(),P.onStickersLoad=!1);var r=P.emojiGetRecentFromStorage();r?P.curEmojiRecent=P.filterEmoji(r):(P.emojiOldRecentPrepare(t,i),P.updateEmojiCont(i)),P.updateRecentEmoji(i),o.onRecentEmojiUpdate&&o.onRecentEmojiUpdate(!0)},filterEmoji:function(e){var t=Object.keys(e);e:for(var i in a)if(a.hasOwnProperty(i))for(var o in a[i])if(a[i].hasOwnProperty(o)){var r=a[i][o],s=t.indexOf(r);if(-1!=s&&(t.splice(s,1),0==t.length))break e}var n={};for(var c in e)e.hasOwnProperty(c)&&-1==t.indexOf(c)&&(n[c]=e[c]);return t.length>0&&P.setRecentEmojiList(n),n},emojiGetRecentFromStorage:function(){try{return JSON.parse(localStorage.getItem("emoji_recent_list"))}catch(e){return!1}},emojiOldRecentPrepare:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var o=e[i],r=void 0,s=void 0;isString(o)?(r=1,s=o):(r=o,s=i),t[s]=r}P.setRecentEmojiList(P.filterEmoji(t))},getRecentEmojiSorted:function(){var e=[];for(var t in P.curEmojiRecent)if(P.curEmojiRecent.hasOwnProperty(t)){var i=P.curEmojiRecent[t];e.push([t,i])}e.sort(function(e,t){return t[1]-e[1]});var o=[];for(var r in e)e.hasOwnProperty(r)&&o.push(e[r][0]);return o.slice(0,20)},incrRecentEmojiRate:function(e,t){P.emojiRecentRateTime||(P.emojiRecentRateTime=Date.now()/1e3-6);var i=Date.now()/1e3-P.emojiRecentRateTime;if(i>=6){var o=Math.min(100,Math.floor(i/6));for(var r in P.curEmojiRecent)if(P.curEmojiRecent.hasOwnProperty(r)){if(r==t)continue;P.curEmojiRecent[r]*=Math.pow(.998076,o)}P.emojiRecentRateTime+=6*o}P.curEmojiRecent[t]||(P.curEmojiRecent[t]=0),P.curEmojiRecent[t]+=1;var s=P.getRecentEmojiSorted();a[-1]=s,s.length>=20&&-1==s.indexOf(t)&&(s.splice(-1),s.push(t));var n={};for(var c in s)if(s.hasOwnProperty(c)){var l=s[c];n[l]=P.curEmojiRecent[l]}P.setRecentEmojiList(n),window.Notifier&&Notifier.lcSend("recent_emoji_set",n)},setRecentEmojiList:function(e){localStorage.setItem("emoji_recent_list",JSON.stringify(e)),P.curEmojiRecent=e},updateEmojiCont:function(e){var t=P.opts[e];0==t.curTab&&(val(geByClass1("emoji_scroll_smiles",t.tt),P.getInitEmojiContent(e)),P.updateEmojiCatTitle(e))},ttEmojiList:function(e,t){var i="",o=P.emojiGetRecentFromStorage();o&&P.setRecentEmojiList(o),a[-1]=P.getRecentEmojiSorted();var r=t||P.SORTED_EMOJI_SECTIONS_CODES;for(var s in r)if(r.hasOwnProperty(s)){var n=r[s];i+=P.getEmojiCategoryHtml(e,n)}return i},getInitEmojiContent:function(e){P.setEmojiLastAddedCategoryIdx(e,1);return P.ttEmojiList(e,[-1,1])},getEmojiCategoryHtml:function(e,t){var i="",o=a[t];if(!o.length)return i;var r=-1==t?"recent":t,s='<div class="emoji_cat_title_helper" data-id="'+t+'" id="emoji_recent_list'+e+"_"+t+'"><div class="emoji_cat_title">'+Object(K.getLang)("global_emoji_cat_"+r)+"</div></div>";return i+=s+=P.emojiGetCatCont(e,o)},getEmojiLastAddedCategoryIdx:function(e){return P.opts[e].lastLoadedEmojiCategoriesIdxes[e]},setEmojiLastAddedCategoryIdx:function(e,t){P.opts[e].lastLoadedEmojiCategoriesIdxes[e]=t},addNextEmojiCategoty:function(e){var t=P.opts[e],i=t.tt,o=P.getEmojiLastAddedCategoryIdx(e);if(!t.emojiCategoryAdding&&!t.allEmojiLoaded)if(t.emojiCategoryAdding=!0,o){var r=geByClass1("emoji_scroll_smiles",i);if(o++,P.SORTED_EMOJI_SECTIONS_CODES.length>o){var s=P.SORTED_EMOJI_SECTIONS_CODES[o];r.insertAdjacentHTML("beforeEnd",P.getEmojiCategoryHtml(e,s)),P.setEmojiLastAddedCategoryIdx(e,o),t.emojiScroll.update()}else t.allEmojiLoaded=!0;t.emojiCategoryAdding=!1}else debugLog("No emoji last category idx")},hideTt:function(e){removeClass(e,P.SHOWN_TT_CLS)},showTt:function(e){addClass(e,P.SHOWN_TT_CLS)},emojiGetCatCont:function(e,t){for(var i="",o="",r=t.length-1,s=0;s<=r;s++)o+=P.emojiWrapItem(e,t[s],s),(s>0&&s%10==9||s>=r)&&(i+='<div class="emoji_smiles_row">'+o+"</div>",o="");return i},updateRecentEmoji:function(e){var t=P.getRecentEmojiSorted(),i=P.emojiGetCatCont(e,t),o=ge("emoji_recent_list"+e+"_-1");if(o){for(var r=o.nextSibling;r&&(r=r.nextSibling,hasClass(r.previousSibling,"emoji_smiles_row"));)re(r.previousSibling);for(var s=ce("div",{innerHTML:i}),n=o.nextSibling,a=o.parentNode;r=s.firstChild;)a.insertBefore(r,n)}},updateRecentStickers:function(e){var t=P.opts[e];if(P.stickers[P.TAB_RECENT_STICKERS]&&t&&t.emojiExpanded){var i=ge("emoji_recent_stickers_cont"+e);if(i){val(i,"");for(var o=P.stickers[P.TAB_RECENT_STICKERS].stickers,r=cf(),s=0;s<o.length;s++){var n=P.render.sticker(e,P.TAB_RECENT_STICKERS,o[s]);r.appendChild(n);var a=68*Math.ceil((s+1)/4);t.needLoadStickers.unshift([e+"_"+P.TAB_RECENT_STICKERS+"_"+o[s][0],a])}i.appendChild(r),P.updateStickersPos(e)}}},findStickerIndex:function(e,t){if(e)for(var i=e.stickers,o=i.length;o--;)if(String(i[o][0])===String(t))return o;return-1},findSticker:function(e,t){var i=P.findStickerIndex(e,t);if(-1!==i)return e.stickers[i]},findFavoriteStickerIndex:function(e){return P.findStickerIndex(P.stickers[P.TAB_FAVORITE_STICKERS],e)},findFavoriteSticker:function(e){return P.findSticker(P.stickers[P.TAB_FAVORITE_STICKERS],e)},findRecentStickerIndex:function(e){return P.findStickerIndex(P.stickers[P.TAB_RECENT_STICKERS],e)},findRecentSticker:function(e){return P.findSticker(P.stickers[P.TAB_RECENT_STICKERS],e)},findPackSticker:function(e){if(P.stickersById&&P.stickersById.hasOwnProperty(e))return P.stickersById[e].sticker},isStickersLoaded:function(){if(P.stickers)for(var e in P.stickers)if(P.stickers.hasOwnProperty(e)&&e!==String(P.TAB_RECENT_STICKERS))return!0;return!1},tabs:{favoriteTabContent:function(e,t){var i=P.TAB_FAVORITE_STICKERS,o="emoji_tab emoji_tab_img_cont emoji_tab_favorite emoji_tab_"+i;if(cur.stickersTab===i&&(o+=" emoji_tab_sel"),0===t&&P.isStickersLoaded()){var r=P.stickers[i];t=r?r.stickers.length:0}return 0===t&&(o+=" unshown"),'<a class="'+o+'" onmousedown="'+e+'" onclick="return cancelEvent(event)"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_favorite"></span></a>'}},favorite:{reminder:function(e){var t=hasClass(e,"on"),i=t?"favoriteRemindOff":"favoriteRemindOn";if(!P[i]){var o={text:function(){return Object(K.getLang)(t?"purchases_stickers_favorite_rm_tt":"purchases_stickers_favorite_add_tt")},black:1,hidedt:100,typeClass:"tt_black",noZIndex:!0,shift:[10,8]},r=domClosest("ui_scroll_container",e);o.appendEl=r;var s=domClosest("ui_scroll_overflow",e),n=getXYRect(e),a=getXYRect(s),c=n.top-a.top,l=(a.right,n.right,a.bottom-n.bottom),d=n.left-a.left,m=(a.width||a.right-a.left)/2;(!vk.rtl&&d>m||vk.rtl&&d<m)&&(o.needLeft=!0,o.shift[0]=9),o.forcetodown=c<P.FAV_ICON_TT_MIN_HEIGHT,o.forcetoup=l<P.FAV_ICON_TT_MIN_HEIGHT,Object(M.showTooltip)(e,o),P[i]=!0,ajax.post("stickers.php",{act:"tt_favorite_off",tt_type:t?1:2})}},addFavoriteSticker:function(e,t,i){var o=P.stickers[P.TAB_FAVORITE_STICKERS];if(o){var r=P.findPackSticker(t);if(r){r[4]=1,o.stickers.unshift(r);var s=P.opts[e],n=s.deletedFavoriteStickers;for(s.deletedFavoriteStickers=[t];o.stickers.length>P.favoriteLimit;)P.favorite.deleteFavoriteSticker(e,o.stickers[o.stickers.length-1][0]);P.favorite.deleteFavoriteStickerElements(e),s.deletedFavoriteStickers=n;var a=P.findRecentSticker(t);a&&(a[4]=1);var c=ge("emoji_favorite_stickers_cont"+e);if(c){var l=P.opts[e].emojiScroll.data.scrollHeight,d=P.opts[e].emojiScroll.data.scrollTop,m=ge("emoji_sticker_item"+e+"_"+P.TAB_FAVORITE_STICKERS+"_"+t);if(!m){m=P.render.sticker(e,P.TAB_FAVORITE_STICKERS,r),P.render.stickerContent(e,m,!1);var u=domFC(c);u?domInsertBefore(m,u):c.appendChild(m),P.opts[e].emojiScroll.update();var f=P.opts[e].emojiScroll.data.scrollHeight-l;P.opts[e].emojiScroll.scrollTop(d+f),P.updateStickersPos(e)}}var _=geByClass1("emoji_tab_"+P.TAB_FAVORITE_STICKERS);if(hasClass(_,"unshown")&&(P.opts[e].curTab===P.TAB_FAVORITE_STICKERS&&removeClass(geByClass1("emoji_tab_"+P.TAB_RECENT_STICKERS),"emoji_tab_sel"),removeClass(_,"unshown")),P.favorite.updateFavoriteStickerElements(e,t,!0),P.opts[e].deletedFavoriteStickers.length>0){var v=indexOf(P.opts[e].deletedFavoriteStickers,t);-1!==v&&P.opts[e].deletedFavoriteStickers.splice(v,1)}}}},deleteFavoriteSticker:function(e,t,i){var o=P.stickers[P.TAB_FAVORITE_STICKERS];if(o){var r=P.findFavoriteStickerIndex(t);if(-1!==r){if(o.stickers.splice(r,1),P.opts[e].deletedFavoriteStickers.push(t),0===o.stickers.length&&i)addClass(geByClass1("emoji_tab_"+P.TAB_FAVORITE_STICKERS),"unshown"),domData(i.parentElement,"pack-id")===String(P.TAB_FAVORITE_STICKERS)&&addClass(geByClass1("emoji_tab_"+P.TAB_RECENT_STICKERS),"emoji_tab_sel");P.favorite.updateFavoriteStickerElements(e,t,!1);var s=P.findRecentSticker(t);s&&(s[4]=0);var n=P.findPackSticker(t);n&&(n[4]=0)}}},deleteFavoriteStickerElement:function(e,t){re("emoji_sticker_item"+e+"_"+P.TAB_FAVORITE_STICKERS+"_"+t)},deleteFavoriteStickerElements:function(e){var t=P.opts[e];t.deletedFavoriteStickers.length>0&&(t.deletedFavoriteStickers.forEach(function(t){P.favorite.deleteFavoriteStickerElement(e,t)}),t.deletedFavoriteStickers=[],P.updateStickersPos(e))},deleteFavoriteStickerElementsAsync:function(e){var t=P.opts[e];t.deleteFavoriteStickersTimeout||(t.deleteFavoriteStickersTimeout=setTimeout(function(){P.favorite.deleteFavoriteStickerElements(e),t.deleteFavoriteStickersTimeout=null},P.DELETE_FAV_STICKER_ELEMENTS_DELAY))},updateFavoriteStickerElements:function(e,t,i){geByClass("sticker_item_"+t).forEach(function(e){domData(e,"fav",i?"1":null),toggleClass(e,"faved",i),toggleClass(geByClass1("emoji_sticker_item_fav",e),"on",i)})}},updateEmojiCatTitle:function(e){var t=P.opts[e];if(t&&t.emojiScroll){var i,o,r,s=ge("emoji_block_"+e),n=geByClass("emoji_cat_title_helper",s),a=t.emojiScroll.data.scrollTop,c=geByClass1("emoji_cats_title_helper",t.tt);if(n.length){var l=n[0];i=P.getSizeCached(l)[1]}for(var d=n.length-1;d>=0;d--)if(a>n[d].offsetTop-i){o=n[d],r=d;break}if(!o)return debugLog("title not found");var m=intval(attr(o,"data-id"));if(t.curEmojiCatId!=m){t.curEmojiCatId=m;var u=[o],f=n[r-1];f&&(addClass(f,"emoji_cat_title_fix"),setStyle(f.firstChild,"transform","translateY("+(o.offsetTop-f.offsetTop-i)+"px)"));for(var _=o.nextSibling;_;)hasClass(_,"emoji_cat_title_fix")&&u.push(_),_=_.nextSibling;for(var v in u)u.hasOwnProperty(v)&&(removeClass(u[v],"emoji_cat_title_fix"),setStyle(u[v].firstChild,"transform","translateY(0px)"));val(c,""),t.emojiTitleHelperIsSet=0}!t.emojiTitleHelperIsSet&&a>=o.offsetTop&&a>0?(val(c,val(o)),t.emojiTitleHelperIsSet=1):t.emojiTitleHelperIsSet&&(a<o.offsetTop||0==a)&&(val(c,""),t.emojiTitleHelperIsSet=0)}},emojiWrapItem:function(e,t,i){var o,r=P.cssEmoji[t];o=r?' title="'+r[1]+'"':"";var s="";return browser.mobile||(s=' onmouseover="return Emoji.emojiOver('+e+', this, true);"'),'<a class="emoji_smile_cont '+("2764"!=t&&i&&i<54?"emoji_smile_shadow":"")+'" '+o+" onmousedown=\"Emoji.addEmoji(Emoji.shownId, '"+t+'\', this); return cancelEvent(event);" onclick="return cancelEvent(event);" '+s+'><div class="emoji_bg"></div><div class="emoji_shadow"></div>'+P.getEmojiHTML(t,!1,!1,!0)+"</a>"},reappendEmoji:function(e,t){var i=P.opts[e];i&&i.rceCont&&(i.addMediaBtn?i.sendWrap.insertBefore(i.rceCont,i.addMediaBtn):i.sendWrap.appendChild(i.rceCont)),t&&(i.ttWrap?i.ttWrap.appendChild(t):i.emojiWrap?i.emojiWrap.appendChild(t):i.obj.appendChild(t),clearTimeout(cur.ttEmojiHide),P.hideTt(t))},ttCalcHeight:function(e,t,i){window.headH=window.headH||ge("page_header")&&P.getSizeCached(ge("page_header"))[1]||0;var o=(window.pageNode&&window.browser.mozilla?Math.min(getSize(pageNode)[1],window.lastWindowHeight):window.lastWindowHeight)||getScroll()[3],r=window.scrollGetY?scrollGetY():getScroll()[1],s=getXY(t)[1],n=P.getSizeCached(t)[1],a=geByClass1("emoji_list",i),c=P.opts[e].emojiSmileHeigh,l=window.headH,d=P.opts[e].emojiRowsCount;isAncestor(t,pageNode)||(l=0),setStyle(a,{height:d*c+8});for(var u,f,_,v,p=r+l,h=r+o,k=i,g=getSize(i)[1];k!==bodyNode&&(k=Object(m.domClosestOverflowHidden)(k));){var S=getXY(k)[1];p=Math.max(p,S),h=Math.min(h,S+getSize(k)[1])}for(_=h-s-n-9,u=(f=s-9-p)<g&&_<g?f>=_:f>=g,P.opts[e].forceUp&&(u=!0),v=u?f:_;v<g&&d>3;)d--,g-=c;P.opts[e].emojiRowsCount=d,P.opts[e].emojiSmileHeigh=c,setStyle(a,{height:d*c+8}),toggleClass(i,"tt_down",u),toggleClass(i,"tt_up",!u)},repositionEmoji:function(e,t,i){var o,r=P.opts[e];if(r){if(i.parentNode&&getXY&&getStyle&&setStyle&&geByClass&&(o=geByClass1("emoji_rpointer",i))){var s=parseInt(getStyle(i,"width")),n=getXY(t)[0],a=parseInt(getStyle(t,"width")),c=getXY(i.parentNode)[0];n+a/2<283?(setStyle(i,"left",-s-c),setStyle(o,"left",n+a/2-20+"px")):(setStyle(i,"left",""),setStyle(o,"left",""))}else setStyle(i,"left","");var l=geByClass1("emoji_list",i),d=geByClass1("emoji_smile_cont",l);if(P.opts[e].emojiSmileHeigh=d&&P.getSizeCached(d)[1]||26,P.opts[e].emojiRowsCount=9,P.ttCalcHeight(e,t,i),r.ttWrap){var m=getSize(r.ttWrap)[0]-(getXY(r.emojiBtn)[0]-getXY(r.ttWrap)[0]);setStyle(i,"right",m-r.ttDiff+"px")}}},emojiOver:function(e,t,i){if(browser.mobile||i&&P.preventMouseOver)return!0;var o=P.opts[e];addClass(t,"emoji_over"),o.emojiOvered&&o.emojiOvered!=t&&removeClass(o.emojiOvered,"emoji_over"),o.emojiOvered=t},emojiExpand:function(e,t){var i=P.opts[e];addClass(t,"emoji_expanded"),P.emojiLoadMore(e),i.emojiScroll?i.emojiScroll.update():(i.emojiScroll=new uiScroll(geByClass1("emoji_list",t),{theme:"default emoji no_transition",shadows:!0,global:!0,noForceReFlow:!0,ondragstart:function(){i.scrolling=!0},ondragstop:function(){i.scrolling=!1,Object(T.isFunction)(i.afterScrollFn)&&i.afterScrollFn()},onscrollstart:function(){window.tooltips&&tooltips.destroyAll(),i.scrollStarted=!0},onupdate:function(t){i.curTab==P.TAB_EMOJI?P.updateEmojiCategories(t,i,e):P.updateShownStickers(e)}}),i.imagesLoader=i.imagesLoader||imagesLoader(i.emojiScroll.scroller,{use_iframe:!0,need_load_class:"emoji_need_load"}),i.sharedTT&&(i.sharedTT.emojiScroll=i.emojiScroll)),i.emojiExpanded=!0},updateEmojiCategories:function(e,t,i){e.data.scrollBottom-P.BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY<=0&&t.scrollStarted&&setTimeout(function(){P.addNextEmojiCategoty(i),P.updateEmojiCatTitle(i)},0),P.updateEmojiCatTitle(i)},updateShownStickers:function(e,t){var i=P.opts[e];if(i.emojiScroll&&i.stickersSplitersPos){i.needLoadStickers||(i.needLoadStickers=[]);var o=i.emojiScroll.data.scrollTop,r=o,s=o+i.emojiScroll.data.viewportHeight,n=i.needLoadStickers;clearTimeout(i.preloadStickersTimer);for(var a=[],c=0;c<n.length;c++){var l=n[c];if(l[1]+72>=r&&l[1]<=s){var d=ge("emoji_sticker_item"+l[0]);if(!d||hasClass(d,"__loaded"))continue;var m=P.render.stickerContent(e,d,!0);a.push([m,l[0]])}}if(P.loadStickers(e,a),a.length||P.preloadStickers(e),!(t||i.scrollAnimation||P.onStickersLoad)){for(var u=-1,f=0;f<i.stickersSplitersPos.length;f++){var _=i.stickersSplitersPos[f];if(!(_[1]-30<o))break;u=_[0]}u!=P.TAB_FAVORITE_STICKERS&&P.favorite.deleteFavoriteStickerElementsAsync(e),i.curTab!=u&&P.scrollToTab(u,e)}}},loadStickers:function(e,t){var i=P.opts[e];if(t.length){for(var o={},r=0;r<t.length;r++){var s=t[r][0]+":"+t[r][1];i.imagesLoading[s]&&(o[s]=i.imagesLoading[s],delete i.imagesLoading[s],t.splice(r,1),r--)}for(var n in i.imagesLoading)if(i.imagesLoading.hasOwnProperty(n)){var a=i.imagesLoading[n];if(!a)return;a.src=""}for(var c in i.imagesLoading=o,t)if(t.hasOwnProperty(c)){var l=t[c][0]+":"+t[c][1];i.imagesLoading[l]=i.imagesLoader.iloader.add(t[c][0],P.onStickerLoaded,e+":"+t[c][1])}}},preloadStickers:function(e){var t=P.opts[e];t.imagesLoading&&Object.keys(t.imagesLoading).length>0||(clearTimeout(t.preloadStickersTimer),t.preloadStickersTimer=setTimeout(function(){var i=t.emojiScroll.data.scrollTop,o=t.emojiScroll.data.viewportHeight,r=i+o,s=i-o,n=i,a=r,c=r+o,l=geByClass1("emoji_scroll_stickers",t.tt);if(isVisible(l)){for(var d=l.firstChild,m=[];d;){if(hasClass(d,"emoji_sticker_item")&&!hasClass(d,"__loaded")){var u=d.offsetTop;if(u>=s&&u<=n||u>=a&&u<=c){var f=d.id.replace("emoji_sticker_item",""),_=P.render.stickerContent(e,d,!0);m.push([_,f])}}d=d.nextSibling}P.loadStickers(e,m)}},50))},onStickerLoaded:function(e){var t=String(this).split(":"),i=t[1],o=intval(t[0]),r=P.opts[o],s=ge("emoji_sticker_item"+i);if(s){var n=geByTag1("img",s);if(n){addClass(s,"__loaded"),attr(n,"src",e),delete P.opts[o].imagesLoading[e+":"+i];for(var a=0;a<r.needLoadStickers.length;a++){if(i==r.needLoadStickers[a][0]){r.needLoadStickers.splice(a,1);break}}Object.keys(P.opts[o].imagesLoading).length||P.preloadStickers(o)}}},emojiMove:function(e){var t=P.shownId,i=P.opts[t];if(P.shown&&i&&i.emojiFocused&&i.openedByTabKey){var o=null;if(i.emojiOvered)switch(e.keyCode){case KEY.LEFT:o=P.getEmojiEl(i.emojiOvered,"left"),cancelEvent(e);break;case KEY.RIGHT:o=P.getEmojiEl(i.emojiOvered,"right"),cancelEvent(e);break;case KEY.UP:o=P.getEmojiEl(i.emojiOvered,"up");break;case KEY.DOWN:o=P.getEmojiEl(i.emojiOvered,"down");break;case KEY.ENTER:if(!P.emojiEnter(t,e))return cancelEvent(e),!1;break;default:return!0}else o=P.getFirstEmojiEl(t);if(o)return P.preventMouseOver=!0,P.emojiOver(t,o),P.scrollToListEl(t,o),!1}return!0},scrollToListEl:function(e,t){var i=P.opts[e];if(i&&i.emojiScroll){var o=t.offsetTop,r=Math.max(o+30-i.emojiScroll.data.viewportHeight,Math.min(i.emojiScroll.data.scrollTop,o-30));i.emojiScroll.data.scrollTop!=r&&i.emojiScroll.scrollTop(r)}},anim:function(e,t){clearInterval(cur._imAnim);var i=Math.floor(300/13),o=0,r=domLC(e),s=domFC(e),n=t?0:45,a=t?45:0,c=t?1:0,l=t?0:1;cur._imAnim=setInterval(function(){var d=++o>=i?a:n+1.95*o*(t?1:-1),m=d-45,u=o>=i?l:c+1/(300/13)*o*(t?-1:1),f=1-u;r.style.WebkitTransform=r.style.OTransform=r.style.transform="rotate("+d+"deg)",s.style.WebkitTransform=s.style.OTransform=s.style.transform="rotate("+m+"deg)",r.style.opacity=u,s.style.opacity=f,o>=i&&(clearInterval(cur._imAnim),(t?addClass:removeClass)(e,"emoji_smile_on"),r.style.WebkitTransform=r.style.OTransform=r.style.transform=s.style.WebkitTransform=s.style.OTransform=s.style.transform=r.style.opacity=s.style.opacity="")},13)},tplSmile:function(e){return'<div class="emoji_smile_wrap _emoji_wrap"><div class="emoji_smile _emoji_btn" title="'+e+'" onmouseover="return Emoji.show(this, event);" onmouseout="return Emoji.hide(this, event);" onclick="return cancelEvent(event);"><div class="emoji_smile_icon"></div></div></div>'},emojiToHTML:s.emojiToHTML,emojiReplace:s.emojiReplace,emojiRegex:Object(o.emojiRegex)(),getCode:function(e){var t=!1;if("emoji_css"==e.className)t=e.getAttribute("emoji");else if(-1!=e.className.indexOf("emoji")){var i=e.src&&e.src.match(/\/([a-f0-9*]+)(_2x)?.png/);t=i?i[1]:e.getAttribute("emoji")}return t},getTabCont:function(e,t){var i="";if(t){var o="",r="",s=P.opts[e].forceStickerPack;for(var n in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(n)){var a=window.emojiStickers[n][0],c=window.emojiStickers[n][1],l=window.emojiStickers[n][4]&&s==a;if(!c&&!l)continue;var d=P.stickers[a];if(!d)continue;var m=a===P.TAB_RECENT_STICKERS,u=a===P.TAB_FAVORITE_STICKERS,f='<div class="clear emoji_stickers_spliter" id="emoji_tab_cont_'+a+"_"+e+'"></div>';m?f+='<div class="emoji_recent_stickers_cont" id="emoji_recent_stickers_cont'+e+'">':u&&(f+='<div class="emoji_favorite_stickers_cont" id="emoji_favorite_stickers_cont'+e+'">');var _=d.stickers;for(var v in _)_.hasOwnProperty(v)&&(f+=P.render.stickerRs(e,a,_[v]));m?o=f+"</div>":u?r=f+"</div>":l?i=f+i:i+=f}i=r+o+i}else i=P.ttEmojiList(e);return i},updateStickersCont:function(e){var t=P.opts[e],i=P.getTabCont(e,P.tabDefaultId);geByClass1("emoji_scroll_stickers",t.tt).innerHTML=i,t.initedStickers=1,t.imagesLoading=[],clearTimeout(t.preloadStickersTimer),P.updateStickersPos(e)},updateStickersPos:function(e){for(var t=P.opts[e],i=[],o=[],r=geByClass1("emoji_scroll_stickers",t.tt).firstChild,s=!1,n=!1;r;){if(!s&&hasClass(r,"emoji_recent_stickers_cont")?(r=r.firstChild,s=!0):!n&&hasClass(r,"emoji_favorite_stickers_cont")&&r.firstChild&&(r=r.firstChild,n=!0),hasClass(r,"emoji_sticker_item")){var a=r.id.replace("emoji_sticker_item","");i.push([a,r.offsetTop])}else if(hasClass(r,"emoji_stickers_spliter")){var c=r.id.replace("emoji_tab_cont_","").split("_");o.push([intval(c[0]),r.offsetTop])}(!r.nextSibling&&s||!r.nextSibling&&n)&&(r=r.parentNode),r=r.nextSibling}t.needLoadStickers=i,t.stickersSplitersPos=o},stickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-opt-id="%optId%" data-sticker-id="%stickerId%" data-pack-id="%selId%" data-src="%stickerUrl%" data-fav="%fav%" data-fav-hash="%favHash%" class="emoji_sticker_item sticker_item_%stickerId% %favClass%" onclick="Emoji.stickerClick(%optId%, %stickerId%, %size%, \'%stickerUrl%\', this, \'%referrer%\');"></a>'},stickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-opt-id="%optId%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%" data-pack-id="%selId%" data-src="%stickerUrl%" data-animation-path="%animationUrl%" data-fav="%fav%" data-fav-hash="%favHash%" class="emoji_sticker_item sticker_item_%stickerId% %favClass%" onclick="Emoji.stickerClick(%optId%, %stickerId%, %size%, \'%stickerUrl%\', this, \'%referrer%\');"></a>'},hintsStickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animationUrl%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%"><img class="emoji_sticker_image sticker_img" src="%stickerUrl%" /></a>'},hintsStickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"><img class="emoji_sticker_image" src="%stickerUrl%" /></a>'},tabSwitch:function(e,t,i,o){if(null!=e){var r=P.opts[i],s=r.tt;"number"==typeof e&&(e=geByClass1("emoji_tab_"+e,s));var n=geByClass1("emoji_scroll_smiles",s),a=geByClass1("emoji_scroll_stickers",s),c=geByClass1("emoji_cats_title_helper",s);if(val(c,""),r.curEmojiCatId=null,t==P.TAB_EMOJI)hide(a),show(n),show(c),r.emojiInited||(val(n,P.getInitEmojiContent(i)),r.emojiInited=!0),r.imagesLoader&&r.imagesLoader.processLoad(),r.emojiOvered&&0===r.curTab&&P.emojiOver(i,P.getFirstEmojiEl(i)),r.curTab!=P.TAB_EMOJI&&r.emojiScroll&&r.emojiScroll.scrollTop(0),P.updateRecentEmoji(i),P.updateEmojiCatTitle(i);else{hide(n),show(a),hide(c);var l=P.stickers&&clone(P.stickers);l&&delete l[P.TAB_RECENT_STICKERS],!window.emojiStickers||!l||isEmpty(l)||!l[t]&&t!=P.TAB_RECENT_STICKERS?(P.onStickersLoad=function(){P.updateTabsOpt(i),P.tabSwitch(t,t,i,o)},P.stickersLoadingProgress(i,t,e),r.stickersInited=!1,r.curTab=null,P.emojiLoadMore(i)):r.stickersInited||(P.updateStickersCont(i),r.stickersInited=!0),(r.curTab!=t||r.afterLoad)&&(P.scrollToStickerPack(i,t,r.curTab==P.TAB_EMOJI),r.afterLoad=0),P.updateShownStickers(i,!0)}P.onStickersLoad&&t!=P.TAB_EMOJI||P.selectTab(i,t,e)}},getFirstEmojiEl:function(e){for(var t=P.opts[e],i=geByClass1("emoji_scroll_smiles",t.tt).firstChild;i;){if(hasClass(i,"emoji_smiles_row"))return i.firstChild;i=i.nextSibling}return null},getEmojiEl:function(e,t){for(var i,o=0,r=e.parentNode,s=0,n=r.firstChild;n&&(s++,n!==e);)n=n.nextSibling;for(;e&&!i;){if("left"==t||"right"==t)(i="left"==t?e.previousSibling:e.nextSibling)||("left"==t?(t="up",s=10):(t="down",s=1));else{if("up"!=t&&"down"!=t)break;for(var a=r;a&&(a="up"==t?a.previousSibling:a.nextSibling)&&!hasClass(a,"emoji_smiles_row"););if(!a)break;if(s&&a)for(var c=0,l=a.firstChild;l&&c<s;){if(++c>=s){i=l;break}l=l.nextSibling}if(i||!a)break;i="up"==t||s&&"down"==t?a.lastChild:a.firstChild}if(++o>20){debugLog("ERR!!");break}}return i},stickerClick:function(e,t,i,o,r,s){var n=P.opts[e];if(!(Date.now()-n.ttShowT<P.CLICK_DELAY||n.preventDoubleClick&&Date.now()-n.preventDoubleClick<P.CLICK_DELAY)){P.opts[e].preventDoubleClick=Date.now();var a=parseInt(attr(r,"data-pack-id")),c=!0;if(window.emojiStickers&&each(window.emojiStickers,function(e,t){if(t[0]==a)return c=!!t[1],!1}),c){var l=P.findRecentStickerIndex(t);-1!==l?P.stickers[P.TAB_RECENT_STICKERS].stickers.splice(l,1):P.stickers[P.TAB_RECENT_STICKERS]||(P.stickers[P.TAB_RECENT_STICKERS]={stickers:[]});var d=domData(r,"animation-path")||"",m=domData(r,"fav"),u=domData(r,"fav-hash");P.stickers[P.TAB_RECENT_STICKERS].stickers.unshift([t,i,o,d,m,u]),ls.set("recent_stickers",P.stickers[P.TAB_RECENT_STICKERS]),n.needUpdateRecentStickers=!0}n.onStickerSend&&n.onStickerSend(t,s,"animation"),statlogsValueEvent("stickers_usage",n.ref,t,s),P.ttHide(e,!1,!1,!0),n.recentSticker=t}},stickerOver:function(e,t){var i={act:"a_stickers_hover",sticker_id:e,from:cur.module};if(isObject(t.tt)&&"IMG"===t.firstChild.nodeName)return t.tt.show();ajax.post("al_im.php",i,{onDone:function(e,i){var o=(cur.tooltips||[]).length,r=["subscribe_post_tt","sticker_extra_tt","sticker_extra_tt"+o,e.image?"":"tt_text_only"];if(r=r.join(" "),e.show){var s={index:o,className:r,content:i,shift:function(){return[-138,0,-200]},hasover:1,slideX:15,showsp:150,cache:1,forcetodown:!0,no_shadow:!0,dir:"left",onShowStart:function(e){var t=e.container,i=getSize(e.container)[1];if(!(i>=225)){var o=intval((225-i)/2)+10,r=intval(getStyle(t,"top",!0));setStyle(t,"top",r+o)}}};gpeByClass("_im_peer_history_w",t)&&(s.appendParentCls="_im_peer_history_w"),Object(M.showTooltip)(t,s)}}})},selectPeer:function(e){if(void 0!==e){var t=P.opts[e];if(t.peer)return t.peer}var i=cur.peer||(cur.mbTo?cur.mbTo[0]:"");if(-3==i&&cur.wdd.imw_dd){var o=0;for(var r in cur.wdd.imw_dd.selected)cur.wdd.imw_dd.selected.hasOwnProperty(r)&&(i=cur.wdd.imw_dd.selected[r][0],o+=1);o>1&&(i="")}return i},showMyStickers:function(){cur.boxMyStickers=showBox("al_im.php",{act:"stickers_my"},{dark:1,stat:["im.css","imn.js",jsc("web/sorter.js")]})},showStickersStore:function(e,t){var i={act:"stickers_store",peer:P.selectPeer(!1!==e?e:void 0),box:1},o=P.opts[e];t&&(i.ref=t),cur.boxStickersStore=showBox("al_im.php",i,{dark:1,stat:["im.css","imn.js","page_help.css",jsc("web/sorter.js")],params:{onDestroy:o&&o.onStoreHide}}),each(geByClass("emoji_smile_icon_promo"),function(e,t){geByClass1("emoji_smile_icon",t.parentNode),re(t)}),each(geByClass("emoji_shop_icon_badge"),function(e,t){re(t)}),P.hasNewStickers=!1},previewSticker:function(e,t,i,o){if(i=i||{},o&&checkEvent(o))return!0;var r={act:"sticker_preview",pack_id:e},s=P.selectPeer();if(i.peer?r.peer=i.peer:s&&(r.peer=s),i.preview&&(r.preview=1),i.gift&&(r.gift=1),i.giftTo&&(r.gift_to=i.giftTo),i.stickerId&&(r.sticker_id=i.stickerId),r.sticker_referrer=i.sticker_referrer||"store",i.name){var n=nav.objLoc[0].split("/");"stickers"==n[0]&&n[1]!=i.name&&nav.setLoc({0:"stickers/"+i.name})}return cur.boxStickersPreview=showBox("al_im.php",r,{dark:1,stat:["im.css","imn.js"],onFail:function(t){if(window.cur.emojiStickersDisabled||(window.cur.emojiStickersDisabled={}),e&&(window.cur.emojiStickersDisabled[e]=!0),t)return!0}}),cancelEvent(o),!1},isStickerPackEnabled:function(e,t){var i=!1;if(!window.emojiStickers&&t)return ajax.post("al_im.php",{act:"a_stickers_list"},{onDone:function(e){window.emojiStickers=e,t()}}),0;if(!window.emojiStickers)return!1;for(var o in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(o)&&window.emojiStickers[o][0]==e){i=!!window.emojiStickers[o][1];break}return i},clickSticker:function(e,t,i){if(window.cur.emojiStickersDisabled&&window.cur.emojiStickersDisabled[e])return!0;var o;if(t){if(0===(o=P.isStickerPackEnabled(e,P.clickSticker.pbind(e,t,i))))return!1;if(o){var r=!1;if(t.getAttribute("contenteditable"))r=t;else{for(var s=t.parentNode,n=!1;(s=s.parentNode)&&!hasClass(s,"js-im-page");){if(hasClass(s,"fc_tab")){n=!0;break}if(hasClass(s,"mv_chat"))break}if(!s)return!1;n?r=geByClass1("fc_editable",s):hasClass(s,"js-im-page")?r=geByClass1("_im_text"):hasClass(s,"mv_chat")&&(r=domByClass(s,"mv_chat_reply_input"))}if(r){var a=P.opts[r.emojiId];P.ttClick(r.emojiId,geByClass1("_emoji_btn",r.parentNode.parentNode),!1,!0);var c=geByClass1("emoji_tab_"+e,a.tt),l=P.stickers&&clone(P.stickers);l&&delete l[-1],!l||isEmpty(l)?(P.onStickersLoad=P.tabSwitch.pbind(e,e,r.emojiId),P.stickersLoadingProgress(r.emojiId,e,c)):(a.initedStickers=0,P.tabSwitch(c,e,r.emojiId))}}}return t&&o||P.previewSticker(e,!1,{sticker_referrer:"message"}),i&&cancelEvent(i),!1},stickersLoadingProgress:function(e,t,i){var o=P.opts[e];removeClass(geByClass1("emoji_tab_sel",o.tt),"emoji_tab_sel"),addClass(i,"emoji_tab_sel"),geByClass1("emoji_scroll_stickers",o.tt).innerHTML='<div class="emoji_scroll_progress">'+rs(vk.pr_tpl,{id:"",cls:"pr_big"})+"</div>"},buyStickers:function(e,t,i,o,r){if(i&&hasClass(i,"secondary"))return!0;var s=P.selectPeer();return ajax.post("/al_im.php",{act:"a_stickers_buy",pack_id:e,hash:o,peer:s,sticker_referrer:unclean(r)},{onDone:function(t,i,o,s,n,a){if(each(geByClass("_sticker_btn_"+e),function(){this.innerHTML=s,this.onmouseover="",this.onclick="",addClass(this,"secondary")}),cur.boxStickersPreview&&cur.boxStickersPreview.hide(),n&&cur.boxStickersStore&&cur.boxStickersStore.hide(),showDoneBox(t),i){P.stickers[P.TAB_RECENT_STICKERS].promoted=a,P.updateTabs(i,o,!0);try{vk.widget&&window.Rpc&&window.Rpc.callMethod("proxy","updateStickers")}catch(e){}"video_live"===r&&window.Videoview&&window.Videoview.onStickersPurchased(e)}var c=cur.tabbedStickersBox;if(c&&c.tbUpdate)for(var l in c.tbUpdate)c.tbUpdate.hasOwnProperty(l)&&(c.tbUpdate[l]=1);var d=cur.emojiId&&cur.emojiId[cur.peer];if(d){var m=geByClass1("emoji_tab_"+e,P.opts[d].tt);m&&P.tabSwitch(m,e,d)}},showProgress:A.lockButton.pbind(i),hideProgress:A.unlockButton.pbind(i),onFail:function(e){return e&&setTimeout(Object(N.showFastBox)(Object(K.getLang)("global_error"),e).hide,3e3),!0}}),cancelEvent(t)},stickerAct:function(e,t,i,o,r){if(r&&hasClass(e,"secondary"))return!0;var s=(r?hasClass(e,"secondary"):hasClass(e,"_im_sticker_activated"))?1:0,n=cur.tabbedStickersBox;if(n)for(var a in n.tbUpdate)n.tbUpdate.hasOwnProperty(a)&&(n.tbUpdate[a]=1);return ajax.post("/al_im.php",{act:"a_stickers_switch",pack_id:t,hash:i,state:s,from_btn:r?1:0},{onDone:function(i,o,n,a){r||(e.innerHTML=i,e.onmouseover="",setStyle(e,{width:"auto"}),toggleClass(e,"_im_sticker_activated",!s)),each(geByClass("_sticker_btn_"+t),function(){this.innerHTML=a,this.onmouseover="",toggleClass(this,"secondary",!s)}),P.updateTabs(o,n,!0);var c=e.parentNode.parentNode;if(!r){if(cur.stickersSorter.destroy(),s){show("im_stickers_deact");var l=ge("im_stickers_deact_wrap");l.firstChild?l.insertBefore(c,l.firstChild):l.appendChild(c),setStyle(c,{cursor:"default"})}else{geByTag1("div","im_stickers_my_wrap").appendChild(c),ge("im_stickers_deact_wrap").childNodes.length||hide("im_stickers_deact")}cur.stickersSorterInit()}},showProgress:A.lockButton.pbind(e),hideProgress:A.unlockButton.pbind(e)}),cancelEvent(o)},getTabsCode:function(e,t){var i=[];e&&i.push.apply(i,e),i.length>1&&(P.hasNewStickers=!1);var o=P.opts[t].forceStickerPack,r="",s="";for(var n in i)if(i.hasOwnProperty(n)){var a=i[n][0],c=i[n][1],l=i[n][3],d=i[n][4]&&a==o,m=i[n][5];if(!c&&!l&&!d)continue;var u=void 0;if(c||d?(a>0&&-1===P.stickerPacksToLoad.indexOf(a)&&P.stickerPacksToLoad.push(a),u="Emoji.tabSwitch(this, "+a+", "+t+"); return cancelEvent(event);"):u="Emoji.previewSticker("+a+", false, {sticker_referrer: 'keyboard'}); return cancelEvent(event);",i[n][2]&&(P.hasNewStickers=i[n][2]),a===P.TAB_RECENT_STICKERS){var f="emoji_tab emoji_tab_img_cont emoji_tab_recent emoji_tab_"+a;cur.stickersTab==a&&(f+=" emoji_tab_sel"),r+='<a class="'+f+'" onmousedown="'+u+'" onclick="return cancelEvent(event);"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_recent"></span></a>'}else if(a===P.TAB_FAVORITE_STICKERS)r+=P.tabs.favoriteTabContent(u,i[n][6]);else if(a){var _="emoji_tab emoji_tab_img_cont emoji_tab_"+a;cur.stickersTab==a&&(_+=" emoji_tab_sel"),c||d||(_+=" emoji_tab_promo");var v='<a class="'+_+'" onmousedown="'+u+'" onclick="return cancelEvent(event);"><img width="22" height="22" src="'+m+'" class="emoji_tab_img" /></a>';d?s=v+s:s+=v}else{var p="emoji_tab emoji_tab_"+a;cur.stickersTab==a&&(p+=" emoji_tab_sel"),c||(p+=" emoji_tab_promo"),r+='<a class="'+p+'" onmousedown="'+u+'" onclick="return cancelEvent(event);"><div class="emoji_tab_icon emoji_sprite emoji_tab_icon_'+a+'"></div></a>'}}return r+s},updateTabsOpt:function(e,t){var i=P.opts[e];if(!i.noStickers){var o=ge("emoji_tabs_cont_"+e);o&&(o.innerHTML=P.getTabsCode(window.emojiStickers,e)),P.checkEmojiSlider(i),P.checkNewStickers(i),void 0!==typeof t&&(i.stickersInited=!!t)}},updateTabs:function(e,t,i){e&&i&&window.Notifier&&Notifier.lcSend("emoji",{act:"updateTabs",newStickers:e,keywords:t});var o=0;for(var r in void 0===t?(P.initStickersKeywords(),window.stickersKeywordsData||(o=1)):(window.stickersKeywordsData=t,P.setStickersKeywords(window.stickersKeywordsData,i)),void 0===e?window.emojiStickers&&window.stickersKeywordsData||ajax.post("al_im.php",{act:"a_stickers_list",need_keywords:o,cache_time:P.cachedStickersKeywordsTime()},{onDone:P.updateTabs}):window.emojiStickers=e,P.opts)P.opts.hasOwnProperty(r)&&P.updateTabsOpt(r,!1);var s=P.stickers&&clone(P.stickers);s&&delete s[P.TAB_RECENT_STICKERS],P.onStickersLoad&&window.emojiStickers&&!isEmpty(s)&&(P.onStickersLoad(),P.onStickersLoad=!1)},checkNewStickers:function(e){var t=e.txt;if(!e.noStickers&&!e.noStickersStore&&window.emojiStickers&&t&&t.getAttribute("contenteditable")){for(var i in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(i)&&window.emojiStickers[i][2]){P.hasNewStickers=window.emojiStickers[i][2];break}P.hasNewStickers<0&&!P.noNewStickers&&setTimeout(function(){each(geByClass("emoji_smile_icon"),function(e,t){var i=t.parentNode;geByClass1("emoji_smile_icon_promo",i)||(i.appendChild(ce("div",{className:"emoji_smile_icon_promo"})),addEvent(t,"mouseover",function(){Object(M.showTooltip)(this,{text:Object(K.getLang)("global_store_stickers_new_available"),shift:[7,1,4],showdt:0,black:1})}))})},hasClass(t,"fc_editable")?200:0)}},checkEmojiSlider:function(e){var t=geByClass1("emoji_tabs_wrap",e.tt),i=!1;if(t){if(t.firstChild.clientWidth&&t.firstChild.clientWidth>t.clientWidth+t.scrollLeft)i=!0;else{var o=t.firstChild.childNodes;o.length>6&&(e.scrollLeft||0)<34*(o.length-6)-16&&(i=!0)}var r=vk.rtl?"l":"r";i?(e.sliderShown=!0,P.scrollToggleArrow(!0,r,e,!0)):e.sliderShown&&(e.sliderShown=!1,P.scrollToggleArrow(!1,r,e,!0))}},giftSticker:function(e,t,i,o){var r={act:"stickers_gift_box",pack_id:e,peers:t,ref:(o=o||{}).ref};return o.from&&(r.from=o.from),r.sticker_referrer=o.sticker_referrer||"store",boxLayerWrap.scrollTop=0,showBox("/al_im.php",r,{stat:["wide_dd.js","wide_dd.css","notifier.css","notifier.js"],dark:1}),cancelEvent(i)},showStickerTT:function(e){var t=e.getAttribute("data-title");t&&Object(M.showTooltip)(e,{text:t,slide:15,shift:[74-getSize(e)[0]/2,120,5],className:"sticker_hint_tt",hasover:1})},scrollToStickerPack:function(e,t,i){var o=P.opts[e],r=ge("emoji_tab_cont_"+t+"_"+e),s=r&&t!=P.tabDefaultId?r.offsetTop+getSize(r)[1]:0;o.scrollAnimation=1,o.emojiScroll.scrollTop(s,i?0:200,function(){o.scrollAnimation=0}),P.scrollToTab(t,e)},toggleStickers:function(e,t){var i=P.opts[e];i&&i.tt?(i.noStickers=t,toggleClass(i.tt,"emoji_no_tabs",t),i.curTab&&P.tabSwitch(0,0,e)):i&&(i.hideStickersInitial=t)},getSizeCached:function(e){return(e=ge(e))?(void 0!==e[P.CACHED_WIDTH_PROP]&&void 0!==e[P.CACHED_HEIGHT_PROP]||(e[P.CACHED_WIDTH_PROP]=e.offsetWidth,e[P.CACHED_HEIGHT_PROP]=e.offsetHeight),[e[P.CACHED_WIDTH_PROP],e[P.CACHED_HEIGHT_PROP]]):[0,0]},clearSizeCached:function(e){(e=ge(e))&&(e[P.CACHED_WIDTH_PROP]=void 0,e[P.CACHED_HEIGHT_PROP]=void 0)},getStickerReferrer:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=P.opts[t];return i&&"stories"===i.ref?P.STICKER_REFERRERS.STORY_KEYBOARD:e===P.TAB_RECENT_STICKERS?P.STICKER_REFERRERS.RECENT:e===P.TAB_FAVORITE_STICKERS?P.STICKER_REFERRERS.FAVORITE:P.STICKER_REFERRERS.KEYBOARD},render:{sticker:function(e,t,i){var o=P.render.stickerRs(e,t,i);return se(o)},stickerRs:function(e,t,i){var o={optId:e,selId:t,stickerId:i[0],size:i[1]?i[1]:256,stickerUrl:i[2],fav:i[4]||"",favHash:i[5]||"",referrer:P.getStickerReferrer(t,e),favClass:i[4]?"faved":""},r="";if(browser.msie&&!browser.msie_edge||!i[3])r=P.stickerItem();else{r=P.stickerItemAnimation();var s=rand(1,1e5);o.animationUrl=i[3],o.uniqId=s}return rs(r,o)},stickerHintRs:function(e,t,i){var o=t,r="";r=t<0?window.promotedStickerUrls&&window.promotedStickerUrls[-o]:i?i[2]:"";var s=i?i[3]:"",n={optId:e,selId:0,stickerId:o,stickerUrl:r,class:o<0?"promo":"",onclick:"Emoji.stickerHintClick("+e+", "+o+", '"+r+"', this)"},a="";return(!browser.msie||browser.msie_edge)&&s&&r?(a=P.hintsStickerItemAnimation(),n.animationUrl=s,n.class+=" sticker_animation"):r&&(a=P.hintsStickerItem()),rs(a,n)},stickerContent:function(e,t,i){var o=attr(t,"data-animation-path"),r=attr(t,"data-src"),s="/images/blank.gif";i||(s=r);var n=attr(t,"data-sticker-id"),a=attr(t,"data-fav-hash"),c=attr(t,"data-fav"),l="";o?l='<div data-uniq-id="'+attr(t,"data-uniq-id")+'" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" class="sticker_animation" data-sticker-id="'+n+'" data-animation-path="'+o+'"><img class="sticker_img emoji_sticker_image" src="'+s+'" data-src="'+r+'"/></div>':l='<img class="emoji_sticker_image" src="'+s+'" data-src="'+r+'"/>';if(P.favoriteAvailable){var d="";1==c&&(d="on"),l+=`<span role="link"\n               onmouseover="Emoji.favorite.reminder(this)"\n               class="emoji_sticker_item_fav ${d}"\n               data-sticker-id="${n}"\n               data-hash="${a}"\n               onmousedown="Stickers.toggleFavorite(this, event, ${e}); cancelEvent(event);"\n               onclick="cancelEvent(event)"></span>`}return val(t,l),r}},__eof:1}}});